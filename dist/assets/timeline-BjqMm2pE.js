import{g as r,S as Z}from"./vendor-gsap-BYvdLAYj.js";import _t from"./index-BbrXr4yz.js";import{S as ft,P as wt,W as ht,a as yt,C as Ne,b as qt,M as Ot,c as vt,d as $t,B as Nt,F as Wt,A as Yt}from"./vendor-three-B90GZkEf.js";import{l as o}from"./logger-2Ii2FPkr.js";import{p as Ie,m as $e}from"./mobileFilmGrain-3z14cPLz.js";function Ht(){const d=document.querySelector("#timeline-cover-canvas");if(!d){o.warn("Cover orb canvas not found");return}if(window.coverOrbInitialized)return o.warn("Cover orb already initialized, skipping duplicate call"),window.coverOrbControls;window.coverOrbInitialized=!0;const g=Ie.isMobile(),w=new ft,t=new wt(45,d.clientWidth/d.clientHeight,.1,100);t.position.z=3.5;const i=new ht({canvas:d,alpha:!0,antialias:!g,powerPreference:g?"low-power":"default"});i.setSize(d.clientWidth,d.clientHeight),i.setPixelRatio(Math.min(window.devicePixelRatio,g?1.25:2));const l={noiseStrength:.13,noiseSpeed:.11,noiseDensity:.73,colorDeep:"#9b7bff",colorLight:"#0063d8",colorHighlight:"#00a4af",fresnelPower:1.3,fresnelIntensity:.33,pulseSpeed:.68,pulseIntensity:.14,rotationSpeed:.24,glitterStrength:.078,glitterDensity:70,specularStrength:1.2,glossiness:28},z=`
    uniform float uTime;
    uniform float uNoiseStrength;
    uniform float uNoiseSpeed;
    uniform float uNoiseDensity;
    
    varying vec2 vUv;
    varying vec3 vNormal;
    varying float vDisplacement;
    varying vec3 vPosition;
    varying vec3 vViewPosition;

    // Simplex 3D Noise 
    // by Ian McEwan, Ashima Arts
    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
    vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}

    float snoise(vec3 v){ 
      const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
      const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

      // First corner
      vec3 i  = floor(v + dot(v, C.yyy) );
      vec3 x0 = v - i + dot(i, C.xxx) ;

      // Other corners
      vec3 g = step(x0.yzx, x0.xyz);
      vec3 l = 1.0 - g;
      vec3 i1 = min( g.xyz, l.zxy );
      vec3 i2 = max( g.xyz, l.zxy );

      //  x0 = x0 - 0.0 + 0.0 * C 
      vec3 x1 = x0 - i1 + 1.0 * C.xxx;
      vec3 x2 = x0 - i2 + 2.0 * C.xxx;
      vec3 x3 = x0 - 1.0 + 3.0 * C.xxx;

      // Permutations
      i = mod(i, 289.0 ); 
      vec4 p = permute( permute( permute( 
                 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
               + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
               + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

      // Gradients
      // ( N*N points uniformly over a square, mapped onto an octahedron.)
      float n_ = 1.0/7.0; // N=7
      vec3  ns = n_ * D.wyz - D.xzx;

      vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

      vec4 x_ = floor(j * ns.z);
      vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

      vec4 x = x_ *ns.x + ns.yyyy;
      vec4 y = y_ *ns.x + ns.yyyy;
      vec4 h = 1.0 - abs(x) - abs(y);

      vec4 b0 = vec4( x.xy, y.xy );
      vec4 b1 = vec4( x.zw, y.zw );

      vec4 s0 = floor(b0)*2.0 + 1.0;
      vec4 s1 = floor(b1)*2.0 + 1.0;
      vec4 sh = -step(h, vec4(0.0));

      vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
      vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

      vec3 p0 = vec3(a0.xy,h.x);
      vec3 p1 = vec3(a0.zw,h.y);
      vec3 p2 = vec3(a1.xy,h.z);
      vec3 p3 = vec3(a1.zw,h.w);

      //Normalise gradients
      vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
      p0 *= norm.x;
      p1 *= norm.y;
      p2 *= norm.z;
      p3 *= norm.w;

      // Mix final noise value
      vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
      m = m * m;
      return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
                                    dot(p2,x2), dot(p3,x3) ) );
    }

    void main() {
      vUv = uv;
      vNormal = normal;
      
      // Calculate noise based displacement
      float noiseVal = snoise(position * uNoiseDensity + uTime * uNoiseSpeed);
      vDisplacement = noiseVal;
      
      // Displace position along normal
      vec3 newPosition = position + normal * (noiseVal * uNoiseStrength);
      vPosition = newPosition;
      
      vec4 mvPosition = modelViewMatrix * vec4(newPosition, 1.0);
      vViewPosition = -mvPosition.xyz;
      
      gl_Position = projectionMatrix * mvPosition;
    }
  `,T=`
    uniform float uTime;
    uniform vec3 uColorDeep;
    uniform vec3 uColorLight;
    uniform vec3 uColorHighlight;
    uniform float uFresnelPower;
    uniform float uFresnelIntensity;
    uniform float uPulseSpeed;
    uniform float uPulseIntensity;
    uniform float uGlitterStrength;
    uniform float uGlitterDensity;
    uniform float uSpecularStrength;
    uniform float uGlossiness;
    
    varying vec2 vUv;
    varying vec3 vNormal;
    varying float vDisplacement;
    varying vec3 vPosition;
    varying vec3 vViewPosition;

    // Simple pseudo-random function
    float random(vec2 st) {
        return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
    }

    void main() {
      // Mix colors based on displacement/noise
      float mixFactor = smoothstep(-0.5, 0.5, vDisplacement);
      vec3 baseColor = mix(uColorDeep, uColorLight, mixFactor);
      
      vec3 viewDirection = normalize(vViewPosition);
      vec3 normal = normalize(vNormal);
      
      // Fresnel effect for metallic look
      float fresnel = pow(1.0 - dot(viewDirection, normal), uFresnelPower);
      
      // Specular Reflection (Blinn-Phong)
      vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0)); // Directional light from top-right-front
      vec3 halfDir = normalize(lightDir + viewDirection);
      float specAngle = max(dot(normal, halfDir), 0.0);
      float specular = pow(specAngle, uGlossiness);
      
      // Glitter Effect
      // Use normal direction for sparkles so they move naturally with rotation
      // Add very slow time component for subtle life
      float glitterNoise = random(vNormal.xy * uGlitterDensity + uTime * 0.05);
      
      // Use smoothstep for softer, more blended sparkles instead of harsh static
      // High threshold (0.95) ensures only peaks sparkle
      float glitter = smoothstep(0.95, 1.0, glitterNoise) * uGlitterStrength * (fresnel + specular);
      
      // Combine
      vec3 finalColor = baseColor;
      finalColor += uColorHighlight * fresnel * uFresnelIntensity; // Rim light
      finalColor += uColorHighlight * specular * uSpecularStrength; // Glossy highlight
      finalColor += vec3(1.0) * glitter; // White sparkles
      
      // Add subtle pulse to alpha/brightness
      float pulse = 1.0 - uPulseIntensity + uPulseIntensity * sin(uTime * uPulseSpeed);
      
      gl_FragColor = vec4(finalColor * pulse, 1.0);
    }
  `,b=new yt({vertexShader:z,fragmentShader:T,uniforms:{uTime:{value:0},uNoiseStrength:{value:l.noiseStrength},uNoiseSpeed:{value:l.noiseSpeed},uNoiseDensity:{value:l.noiseDensity},uColorDeep:{value:new Ne(l.colorDeep)},uColorLight:{value:new Ne(l.colorLight)},uColorHighlight:{value:new Ne(l.colorHighlight)},uFresnelPower:{value:l.fresnelPower},uFresnelIntensity:{value:l.fresnelIntensity},uPulseSpeed:{value:l.pulseSpeed},uPulseIntensity:{value:l.pulseIntensity},uGlitterStrength:{value:l.glitterStrength},uGlitterDensity:{value:l.glitterDensity},uSpecularStrength:{value:l.specularStrength},uGlossiness:{value:l.glossiness}},transparent:!0}),$=g?64:128,q=new qt(1,$,$),D=new Ot(q,b);w.add(D),window.coverOrbParams=l,window.coverOrbUniforms=b.uniforms,window.coverOrbMaterial=b,window.coverOrbOrb=D;const S=()=>{if(window.gui){if(window.gui.__folders&&window.gui.__folders["Cover Orb"])return;const P=window.gui.addFolder("Cover Orb");P.add(l,"noiseStrength",0,2).name("Noise Strength"),P.add(l,"noiseSpeed",0,2).name("Noise Speed"),P.add(l,"noiseDensity",0,5).name("Noise Density"),P.addColor(l,"colorDeep").name("Color Deep"),P.addColor(l,"colorLight").name("Color Light"),P.addColor(l,"colorHighlight").name("Color Highlight"),P.add(l,"fresnelPower",0,5).name("Fresnel Power"),P.add(l,"fresnelIntensity",0,5).name("Fresnel Intensity"),P.add(l,"specularStrength",0,2).name("Spec Strength"),P.add(l,"glossiness",1,100).name("Glossiness"),P.add(l,"glitterStrength",0,2).name("Glitter Str"),P.add(l,"glitterDensity",1,200).name("Glitter Dens"),P.add(l,"pulseSpeed",0,5).name("Pulse Speed"),P.add(l,"pulseIntensity",0,1).name("Pulse Intensity"),P.add(l,"rotationSpeed",0,1).name("Rotation Speed"),P.open()}else setTimeout(S,1500)};setTimeout(S,1500);const C=new vt;let O,N=!1;const oe=g?45:60,J=g?30:45;let se=oe,U=1e3/se,pe=0;Ie.onScrollStateChange(({isScrolling:P})=>{se=P?J:oe,U=1e3/se});const Q=()=>{if(N)return;O=requestAnimationFrame(Q);const P=performance.now(),ee=P-pe;if(ee<U||document.hidden)return;pe=P-ee%U;const re=C.getElapsedTime();b.uniforms.uTime.value=re,b.uniforms.uNoiseStrength.value=l.noiseStrength,b.uniforms.uNoiseSpeed.value=l.noiseSpeed,b.uniforms.uNoiseDensity.value=l.noiseDensity,b.uniforms.uColorDeep.value.set(l.colorDeep),b.uniforms.uColorLight.value.set(l.colorLight),b.uniforms.uColorHighlight.value.set(l.colorHighlight),b.uniforms.uFresnelPower.value=l.fresnelPower,b.uniforms.uFresnelIntensity.value=l.fresnelIntensity,b.uniforms.uPulseSpeed.value=l.pulseSpeed,b.uniforms.uPulseIntensity.value=l.pulseIntensity,b.uniforms.uGlitterStrength.value=l.glitterStrength,b.uniforms.uGlitterDensity.value=l.glitterDensity,b.uniforms.uSpecularStrength.value=l.specularStrength,b.uniforms.uGlossiness.value=l.glossiness,D.rotation.y=re*l.rotationSpeed,D.rotation.z=re*(l.rotationSpeed*.5),i.render(w,t)};Q();const ge=()=>{if(!d)return;const P=d.clientWidth,ee=d.clientHeight,re=P/ee;t.aspect=re,t.updateProjectionMatrix();const v=3.5,_=2.7/re;t.position.z=Math.max(v,_),i.setSize(P,ee),i.setPixelRatio(Math.min(window.devicePixelRatio,2))};window.addEventListener("resize",ge),ge();const we={pause:()=>{N=!0,O&&cancelAnimationFrame(O)},resume:()=>{N&&(N=!1,Q())},cleanup:()=>{N=!0,O&&cancelAnimationFrame(O),window.removeEventListener("resize",ge),i.dispose(),q.dispose(),b.dispose(),window.coverOrbInitialized=!1}};return window.coverOrbControls=we,we}function Xt(){const d=document.querySelector("#timeline-shader-bg");if(!d){o.warn("Timeline Shader: Canvas #timeline-shader-bg not found");return}const g=Ie.getSettings(),w=Ie.isMobile(),t=g.timelineShaderDotCount||{x:62,y:36},i={dotCountX:t.x,dotCountY:t.y,spacing:.8,dotSize:w?8:10,waveSpeed:.32,waveFrequencyX:.16,waveFrequencyY:.32,waveAmplitude:1.9,color:"#4fb3d9",opacity:.58,rotationX:-1.7,rotationY:0,rotationZ:.26,cameraZ:60,bobbingAmplitude:1.4,bobbingSpeed:.22,positionX:-2,positionY:-30,positionZ:-16,fadeIntensity:.86};window.timelineShaderParams=i,i.scale=(window.innerWidth>1440,3.4),setTimeout(()=>{if(window.gui){let v=window.gui.__folders["Timeline Shader"];v||(v=window.gui.addFolder("Timeline Shader")),v.add(i,"waveSpeed",0,2).name("Wave Speed"),v.add(i,"waveAmplitude",0,10).name("Amplitude"),v.add(i,"waveFrequencyX",0,1).name("Freq X"),v.add(i,"waveFrequencyY",0,1).name("Freq Y"),v.add(i,"bobbingAmplitude",0,20).name("Bob Amplitude"),v.add(i,"bobbingSpeed",0,2).name("Bob Speed"),v.add(i,"fadeIntensity",0,1).name("Fade Intensity").onChange(W=>{S&&S.uniforms&&(S.uniforms.uFadeIntensity.value=W)}),v.add(i,"dotSize",.1,10).name("Dot Size").onChange(W=>{S&&S.uniforms&&(S.uniforms.uSize.value=W*T.getPixelRatio())}),v.addColor(i,"color").name("Dot Color").onChange(W=>{S&&S.uniforms&&S.uniforms.uColor.value.set(W)}),v.add(i,"opacity",0,1).name("Opacity").onChange(W=>{S&&S.uniforms&&(S.uniforms.uOpacity.value=W)}),v.add(i,"scale",.1,5).name("Scale").onChange(W=>{C&&C.scale.set(W,W,W)});const _=v.addFolder("Position");_.add(i,"positionX",-200,200).name("Pos X"),_.add(i,"positionY",-200,200).name("Pos Y"),_.add(i,"positionZ",-200,200).name("Pos Z");const ce=v.addFolder("Rotation");ce.add(i,"rotationX",-Math.PI,Math.PI).name("Rot X"),ce.add(i,"rotationY",-Math.PI,Math.PI).name("Rot Y"),ce.add(i,"rotationZ",-Math.PI,Math.PI).name("Rot Z")}},1e3);const l=new ft,z=new wt(75,window.innerWidth/window.innerHeight,.1,1e3);z.position.z=i.cameraZ;const T=new ht({canvas:d,alpha:!0,antialias:!1,powerPreference:w?"low-power":"default"});T.setSize(window.innerWidth,window.innerHeight),T.setPixelRatio(Math.min(window.devicePixelRatio,w?.75:1.25)),d.style.width=`${window.innerWidth}px`,d.style.height=`${window.innerHeight}px`;const b=new Nt,$=[],q=-(i.dotCountX*i.spacing)/2,D=-(i.dotCountY*i.spacing)/2;for(let v=0;v<i.dotCountX;v++)for(let _=0;_<i.dotCountY;_++){const ce=q+v*i.spacing,W=D+_*i.spacing;$.push(ce,W,0)}b.setAttribute("position",new Wt($,3));const S=new yt({uniforms:{uTime:{value:0},uColor:{value:new Ne(i.color)},uOpacity:{value:i.opacity},uSize:{value:i.dotSize*T.getPixelRatio()},uFrequencyX:{value:i.waveFrequencyX},uFrequencyY:{value:i.waveFrequencyY},uAmplitude:{value:i.waveAmplitude},uFadeIntensity:{value:i.fadeIntensity}},vertexShader:`
      uniform float uTime;
      uniform float uSize;
      uniform float uFrequencyX;
      uniform float uFrequencyY;
      uniform float uAmplitude;
      
      varying float vDepth;
      
      void main() {
        vec3 pos = position;
        
        // Calculate wave displacement
        // Combine sine waves for organic movement
        float wave1 = sin(pos.x * uFrequencyX + uTime) * uAmplitude;
        float wave2 = cos(pos.y * uFrequencyY + uTime * 0.8) * uAmplitude * 0.5;
        
        pos.z += wave1 + wave2;
        
        vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);
        gl_Position = projectionMatrix * mvPosition;
        
        // Pass depth to fragment shader for fade effect
        vDepth = -mvPosition.z;
        
        // Size attenuation based on depth
        gl_PointSize = uSize * (30.0 / vDepth);
      }
    `,fragmentShader:`
      uniform vec3 uColor;
      uniform float uOpacity;
      uniform float uFadeIntensity;
      
      varying float vDepth;
      
      void main() {
        // Circular dot shape
        vec2 center = gl_PointCoord - vec2(0.5);
        float dist = length(center);
        
        if (dist > 0.5) discard;
        
        // Soft edge
        float alpha = 1.0 - smoothstep(0.3, 0.5, dist);
        
        // Apply fog-like fade based on depth
        // Normalize depth to 0-1 range (adjust these values for fade distance)
        float depthFade = 1.0 - smoothstep(30.0, 100.0, vDepth);
        depthFade = mix(1.0, depthFade, uFadeIntensity);
        
        gl_FragColor = vec4(uColor, uOpacity * alpha * depthFade);
      }
    `,transparent:!0,depthWrite:!1,blending:Yt}),C=new $t(b,S);C.rotation.x=i.rotationX,C.rotation.y=i.rotationY,C.rotation.z=i.rotationZ,C.scale.set(i.scale,i.scale,i.scale),C.position.set(i.positionX,i.positionY,i.positionZ),l.add(C);const O=new vt;let N,oe=!1,J=!0,se=!1;const U=w?30:60,pe=w?20:45;let Q=U,ge=1e3/Q,we=0;Ie.onScrollStateChange(({isScrolling:v})=>{se=v,Q=v?U:pe,ge=1e3/Q});const P=new IntersectionObserver(v=>{v.forEach(_=>{J=_.isIntersecting})},{threshold:.1,rootMargin:"50px"});P.observe(d);function ee(){if(oe)return;N=requestAnimationFrame(ee);const v=performance.now(),_=v-we;if(_<ge||!J||document.hidden)return;we=v-_%ge;const ce=O.getElapsedTime();if(w&&se?S.uniforms.uTime.value+=.008:S.uniforms.uTime.value=ce*i.waveSpeed,(!w||!se)&&(S.uniforms.uFrequencyX.value=i.waveFrequencyX,S.uniforms.uFrequencyY.value=i.waveFrequencyY,S.uniforms.uAmplitude.value=i.waveAmplitude,S.uniforms.uColor.value.set(i.color),S.uniforms.uFadeIntensity.value=i.fadeIntensity),S.uniforms.uOpacity.value=i.opacity,!w){const W=Math.sin(ce*i.bobbingSpeed)*i.bobbingAmplitude;C.position.set(i.positionX,i.positionY+W,i.positionZ),C.rotation.x=i.rotationX,C.rotation.y=i.rotationY,C.rotation.z=i.rotationZ,C.scale.set(i.scale,i.scale,i.scale)}T.render(l,z)}function re(){z.aspect=window.innerWidth/window.innerHeight,z.updateProjectionMatrix(),T.setSize(window.innerWidth,window.innerHeight),S.uniforms.uSize.value=i.dotSize*T.getPixelRatio(),d.style.width=`${window.innerWidth}px`,d.style.height=`${window.innerHeight}px`,i.scale=(window.innerWidth>1440,3.4),C.scale.set(i.scale,i.scale,i.scale)}return window.addEventListener("resize",re),requestAnimationFrame(ee),{stop:()=>{oe=!0,cancelAnimationFrame(N),window.removeEventListener("resize",re),P.disconnect()},resume:()=>{oe&&(oe=!1,window.addEventListener("resize",re),w||re(),O.start(),we=performance.now(),requestAnimationFrame(ee))},updateParams:v=>{Object.assign(i,v)},setTargetFPS:v=>{Q=v,ge=1e3/v}}}r.ticker.lagSmoothing(0);Ie.onFpsCapChange(d=>{o.log(`[Timeline] Applying GSAP ticker fps cap: ${d.cap}fps (${d.reason})`),r.ticker.fps(d.cap)});let Je=0,Pe=window.matchMedia("(max-width: 1024px)").matches;window.matchMedia("(max-width: 1024px)").addEventListener("change",d=>{Pe=d.matches});const Gt=Pe?250:150;function oi(){const d={timestamp:Date.now(),elements:{},shaderInit:!1,orbInit:!1,positionCaptured:!1,attempts:0,errors:[]};window._isTimelineDismissed=!1,window._isDismissing=!1;const g=document.querySelector("#acs-timeline"),w=document.querySelector("#timeline-window-start"),t=document.querySelector("#timeline-window-bg"),i=document.querySelector(".get-involved-message");if(d.elements.timeline=!!g,d.elements.windowStart=!!w,d.elements.windowBg=!!t,d.elements.getInvolvedMessage=!!i,document.querySelector("#timeline-shader-bg")&&!window.timelineShaderControls)try{window.timelineShaderControls=Xt(),d.shaderInit=!!window.timelineShaderControls,window.timelineShaderControls&&window.timelineShaderControls.stop&&window.timelineShaderControls.stop()}catch(e){o.warn("[Timeline] Shader initialization failed:",e.message),d.errors.push({type:"shader",message:e.message})}if(document.querySelector("#timeline-cover-canvas")&&!window.coverOrbControls)try{window.coverOrbControls=Ht(),d.orbInit=!!window.coverOrbControls,window.coverOrbControls&&window.coverOrbControls.pause&&window.coverOrbControls.pause()}catch(e){o.warn("[Timeline] Cover orb initialization failed:",e.message),d.errors.push({type:"coverOrb",message:e.message})}if(!g||!w||!t||!i){o.warn("Timeline: Required elements not found. Skipping timeline initialization.",d.elements),window.dispatchEvent(new CustomEvent("timeline:init-failed",{detail:{reason:"missing-elements",state:d}}));return}const l=g.querySelector(".timeline-container"),z=g.querySelector(".timeline-track");if(!l||!z){o.warn("Timeline: Container or track not found. Skipping timeline initialization.");return}typeof window.backgroundPaused>"u"&&(window.backgroundPaused=!1);let T=null,b=null,$=!0;const q=(e,n,s)=>e+(n-e)*s,D=()=>{if(!w)return o.warn("[Timeline] getSpanPosition: timelineWindowStart element is null"),null;const e=w.getBoundingClientRect();if(e.width===0||e.height===0){try{const n=window.getComputedStyle(w);o.warn("[Timeline] Zero-dimension element detected:",{width:e.width,height:e.height,top:e.top,left:e.left,display:n.display,visibility:n.visibility,opacity:n.opacity,position:n.position,parentVisible:w.parentElement?window.getComputedStyle(w.parentElement).display:"no-parent"})}catch(n){o.warn("[Timeline] Zero-dimension element - could not get computed style:",n.message)}return null}return{top:e.top-2,left:e.left-6,width:e.width+12,height:e.height+4}},S=()=>{const e=D();return!e||!t?!1:(T={...e},b={...e},R={...e},t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",t.style.borderRadius="4px",t.style.zIndex="0",!0)},C=()=>{if(!w||!t||!$)return;const e=w.getBoundingClientRect();if(e.width===0||e.height===0)return;const n=.1,s=.5,m=.5;b||(b={top:0,left:0,width:0,height:0}),!(!(Math.abs(e.top-b.top)>n||Math.abs(e.left-b.left)>s||Math.abs(e.width-b.width)>m||Math.abs(e.height-b.height)>m)&&b.top!==0)&&(b={top:e.top,left:e.left,width:e.width,height:e.height},T?T={top:q(T.top,e.top,.6),left:q(T.left,e.left,.6),width:q(T.width,e.width,.6),height:q(T.height,e.height,.6)}:T={top:e.top,left:e.left,width:e.width,height:e.height},t.style.position="fixed",t.style.top=`${T.top}px`,t.style.left=`${T.left}px`,t.style.width=`${T.width}px`,t.style.height=`${T.height}px`,t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",t.style.zIndex="0",t.style.borderRadius="4px")};r.set(t,{opacity:0,visibility:"hidden"});const O=document.createElement("style");O.id="timeline-window-start-bg-style",O.textContent=`
    #timeline-window-start::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -6px;
      right: -6px;
      bottom: -2px;
      background: linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164));
      border-radius: 4px;
      opacity: 0;
      z-index: -1;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
  `,document.head.appendChild(O),w.style.position="relative",w.style.zIndex="1";let N=0;const oe=6,J=()=>{N++;const e=D();return e?(T={...e},b={...e},R={...e},t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",t.style.borderRadius="4px",o.log(`[Timeline] Background position captured on attempt ${N}:`,e),!0):!1};requestAnimationFrame(()=>{J()||setTimeout(()=>{J()||setTimeout(()=>{J()||setTimeout(()=>{J()||setTimeout(()=>{J()||setTimeout(()=>{J()||(o.warn(`[Timeline] Failed to capture background position after ${oe} attempts over 1050ms`),window.dispatchEvent(new CustomEvent("timeline:init-failed",{detail:{reason:"position-capture-failed",attempts:N,elementExists:!!w}})))},400)},300)},200)},100)},50)});const se=new ResizeObserver(()=>{$&&!document.body.classList.contains("in-timeline")&&S()});se.observe(document.body);let U=null,pe=!1,Q=0;const ge=Pe?5:3,we=()=>{if(pe)return;pe=!0,Q=0;const e=()=>{pe&&(Q++,Q%ge===0&&C(),U=requestAnimationFrame(e))};e()},P=()=>{pe&&(pe=!1,U!==null&&(cancelAnimationFrame(U),U=null),Q=0)},ee=Z.create({trigger:i,start:"top bottom",end:"bottom top",onEnter:()=>{try{if(H||window._isTimelineDismissed)return;S(),we()}catch(e){o.warn("[Timeline] Error in tracking onEnter:",e.message)}},onLeave:()=>{},onEnterBack:()=>{try{if(H||window._isTimelineDismissed){o.log("[Tracking] onEnterBack blocked - timeline is dismissed");return}S(),we()}catch(e){o.warn("[Timeline] Error in tracking onEnterBack:",e.message)}},onLeaveBack:()=>{try{P()}catch(e){o.warn("[Timeline] Error in tracking onLeaveBack:",e.message)}}});if(ee||o.warn("[Timeline] Failed to create tracking ScrollTrigger"),Pe&&g){const e=()=>{$e.hide(),$e.setOpacity(0);const s=document.getElementById("mobile-film-grain");s&&(s.style.opacity="0",s.style.display="none",s.style.visibility="hidden")},n=()=>{$e.setOpacity(.25),$e.show();const s=document.getElementById("mobile-film-grain");s&&(s.style.visibility="visible",s.style.display="block",s.style.opacity="0.25")};Z.create({trigger:g,start:"top 80%",end:"bottom 20%",onEnter:()=>{H||window._isTimelineDismissed||(o.log("[Timeline] Mobile: Pausing background elements for performance"),window.backgroundPaused=!0,e())},onLeave:()=>{H||window._isTimelineDismissed||(o.log("[Timeline] Mobile: Resuming background elements"),window.backgroundPaused=!1,n())},onEnterBack:()=>{if(H||window._isTimelineDismissed){o.log("[Timeline] Mobile onEnterBack blocked - timeline is dismissed");return}o.log("[Timeline] Mobile: Pausing background elements (scrolled back)"),window.backgroundPaused=!0,e()},onLeaveBack:()=>{H||window._isTimelineDismissed||(o.log("[Timeline] Mobile: Resuming background elements (scrolled back up)"),window.backgroundPaused=!1,n())}})}const v=r.utils.toArray(".timeline-event"),_=r.utils.toArray(".timeline-decade"),ce=v.length-1,W=()=>{const e=window.innerWidth;return e<1025?e:e>=1280?Math.min(1324,e*.92):e*.5},fe=()=>Pe,bt=()=>window.innerHeight*1,St=()=>window.innerHeight*(fe()?.7:.88),kt=()=>bt()+ce*St(),j=fe()?.6:.88,ye=.08,We=j+ye,Ye=.09+ye,xt=ce*We,Be=Ye+xt;let F={isLocked:!1,targetIndex:-1,unlockTimer:null,reason:""},He=0,A=null,B=null,Me=null,he=!1,Xe=0,k;const Qe=(e,n,s=0)=>{if(!e||!k)return;const m=[],h=e.querySelector(".event-year"),c=e.querySelector(".event-description"),f=e.querySelector(".event-image");h&&m.push(h),c&&m.push(c),f&&m.push(f),m.length&&k.fromTo(m,{opacity:0},{opacity:1,duration:Math.max(.25,j*.65),ease:"power2.out",stagger:.08,force3D:!0},n?`${n}+=${s}`:s)},et=e=>{if(A||(A=document.querySelector("#current-timeline-year")),!A){he=!1;return}r.set(A,{opacity:1}),A.textContent=e,Me=e,B=new _t(A,{types:"chars",charClass:"split-char"}),B.chars&&B.chars.length>0?(r.set(B.chars,{opacity:0,y:20,display:"inline-block",force3D:!0}),r.to(B.chars,{opacity:1,y:0,duration:.27,stagger:.02,ease:"power2.out",overwrite:!0,force3D:!0,onComplete:()=>{he=!1}})):he=!1},Tt=e=>{if(!(!e||e===Me||he)){if(he=!0,A||(A=document.querySelector("#current-timeline-year")),!A){he=!1;return}B&&B.chars&&B.chars.length>0?r.to(B.chars,{opacity:0,y:-20,duration:.17,stagger:.01,ease:"power2.in",force3D:!0,onComplete:()=>{B&&typeof B.revert=="function"&&B.revert(),et(e)}}):et(e)}},tt=()=>{A||(A=document.querySelector("#current-timeline-year")),A&&r.to(A,{opacity:0,duration:.3,ease:"power2.out",force3D:!0,onComplete:()=>{B&&typeof B.revert=="function"&&B.revert(),A.textContent="",Me=null,he=!1}})};function it(){o.log("[Re-entry] Starting timeline re-entry"),xe=!0,o.log("[Re-entry] Set isReEntering flag to TRUE - scroll positioning disabled"),H=!1,Re=!1,window._isTimelineDismissed=!1,window._isDismissing=!1,r.set(i,{opacity:1}),g.classList.contains("closed")||o.warn("[Re-entry] Timeline was not collapsed, should have been"),r.killTweensOf(t),t.style.cssText="";const e=D(),n=e?e.top:window.innerHeight/2-20,s=e?e.left:window.innerWidth/2-100,m=e?e.width:200,h=e?e.height:40;e&&(R={...e}),t.style.position="fixed",t.style.top=`${n}px`,t.style.left=`${s}px`,t.style.width=`${m}px`,t.style.height=`${h}px`,t.style.zIndex="9999",t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",t.style.pointerEvents="none",t.style.visibility="visible",t.style.display="block",t.style.borderRadius="4px",t.style.opacity="0.5",o.log("[Re-entry] Background positioned to match timeline-window-start:",{top:n,left:s,width:m,height:h,posValid:!!e});function c(){o.log("[Re-entry] Starting background expansion animation"),t.style.setProperty("--decal-opacity","0"),o.log("[Re-entry] Set shader background (--decal-opacity) to 0");const p=document.getElementById("timeline-window-start-bg-style");p&&(p.textContent=`
          #timeline-window-start::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -6px;
            right: -6px;
            bottom: -2px;
            background: linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164));
            border-radius: 4px;
            opacity: 0 !important;
            z-index: -1;
            pointer-events: none;
            transition: none !important;
          }
        `);const y=r.timeline({onComplete:()=>{o.log("[Re-entry] Expansion complete, now locking background"),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.opacity="1",t.style.visibility="visible",t.style.display="block",t.style.borderRadius="0px",t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",t.style.zIndex="9999",ve=!0,o.log("[Re-entry] Background locked at fullscreen - isBgLockedFullscreen = TRUE");function M(){if(!ve)return;(t.style.top!=="0px"||t.style.left!=="0px"||t.style.width!=="100vw"||t.style.height!=="100vh")&&(o.warn("[Re-entry] AGGRESSIVE LOCK: Background style modified! Forcing full viewport bounds..."),t.style.cssText="position:fixed;top:0;left:0;width:100vw;height:100vh;opacity:1;visibility:visible;display:block;z-index:9999;transform:none;margin:0;padding:0;background:linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164));border-radius:0px;"),requestAnimationFrame(M)}M(),o.log("[Re-entry] Started aggressive fullscreen protection loop"),document.body.classList.add("in-timeline"),o.log("[Re-entry] Added .in-timeline class for protection"),o.log("[Re-entry] Background locked at fullscreen, now restoring timeline content"),f()}});y.to(t,{top:0,left:0,width:"100vw",height:"100vh",borderRadius:"0px",opacity:1,duration:.6,ease:"power2.inOut",onStart:()=>{o.log("[Re-entry] Background expansion started"),t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",t.style.visibility="visible",t.style.display="block",t.style.zIndex="9999"},onUpdate:function(){const M=this.progress();t.style.visibility="visible",t.style.display="block",t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",(M===0||M===.5||M===1)&&o.log(`[Re-entry] Expansion progress: ${(M*100).toFixed(0)}%, opacity: ${t.style.opacity}, size: ${t.style.width} x ${t.style.height}`)},onComplete:()=>{o.log("[Re-entry] Background expansion animation complete"),t.style.opacity="1",t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))"}},0),y.fromTo(t,{opacity:.5},{opacity:1,duration:.6,ease:"none"},0),y.to(i,{opacity:0,duration:.4,ease:"power2.in"},.2);const a=document.querySelector("#background-canvas");a&&y.to(a,{opacity:0,duration:.5,ease:"power2.inOut"},0);const E=document.documentElement;E.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",o.log("[Re-entry] Starting expansion timeline, duration:",y.duration()),y.play()}function f(){o.log("[Re-entry] Restoring timeline content and structure"),g.style.pointerEvents="",g.style.display="",g.classList.remove("closed"),g.style.opacity="0",l.style.opacity="0",Ae.forEach(a=>{a&&a.enable&&a.enable()}),Z.getAll().forEach(a=>{(a.vars.trigger===g||a.vars.trigger===i||a.vars.pin===l)&&a.enable()}),r.utils.toArray(".timeline-event").forEach(a=>{r.set(a,{opacity:0})});const y=document.querySelector(".timeline-track");y&&r.set(y,{x:0,y:0}),requestAnimationFrame(()=>{Z.refresh(),requestAnimationFrame(()=>{o.log("[Re-entry] Content restored, now scrolling to timeline"),u()})})}function u(){let p;if(k&&k.scrollTrigger){const y=window.innerHeight*.35;p=k.scrollTrigger.start+y}else p=g.getBoundingClientRect().top+window.scrollY;o.log("[Re-entry] Scrolling to timeline position:",p),document.body.classList.add("in-timeline"),window.backgroundPaused||(window.backgroundPaused=!0,window.dispatchEvent(new CustomEvent("timeline:backgroundPaused",{detail:{paused:!0}}))),window.shaderBackgroundRenderer&&window.shaderBackgroundRenderer.setInTimeline&&window.shaderBackgroundRenderer.setInTimeline(!0),window.coverOrbControls&&window.coverOrbControls.resume&&window.coverOrbControls.resume(),window.timelineShaderControls&&window.timelineShaderControls.resume&&window.timelineShaderControls.resume(),k&&k.scrollTrigger&&k.progress(0),window.lenis?window.lenis.scrollTo(p,{duration:.8,easing:y=>Math.min(1,1.001-Math.pow(2,-10*y)),onComplete:()=>{o.log("[Re-entry] Scroll complete, fading in timeline"),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.opacity="1",t.style.visibility="visible",t.style.display="block",t.style.borderRadius="0px",t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",o.log("[Re-entry] Locked background at fullscreen state"),xe=!1,ve=!1,o.log("[Re-entry] Cleared isReEntering and isBgLockedFullscreen flags to FALSE - scroll positioning re-enabled"),t.style.zIndex="5",r.to(g,{opacity:1,duration:.3,ease:"power2.out"}),r.to(l,{opacity:1,duration:.3,ease:"power2.out"}),r.to(t,{"--decal-opacity":1,duration:.5,ease:"power2.out",onUpdate:function(){const y=r.getProperty(t,"--decal-opacity")||0;t.style.setProperty("--decal-opacity",y)}}),o.log("[Re-entry] Fading in shader background (--decal-opacity)")}}):(window.scrollTo({top:p,behavior:"smooth"}),setTimeout(()=>{o.log("[Re-entry] Scroll complete, fading in timeline"),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.opacity="1",t.style.visibility="visible",t.style.display="block",t.style.borderRadius="0px",t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",o.log("[Re-entry] Locked background at fullscreen state (fallback)"),xe=!1,ve=!1,o.log("[Re-entry] Cleared isReEntering and isBgLockedFullscreen flags to FALSE - scroll positioning re-enabled"),t.style.zIndex="5",r.to(g,{opacity:1,duration:.3,ease:"power2.out"}),r.to(l,{opacity:1,duration:.3,ease:"power2.out"}),r.to(t,{"--decal-opacity":1,duration:.5,ease:"power2.out",onUpdate:function(){const y=r.getProperty(t,"--decal-opacity")||0;t.style.setProperty("--decal-opacity",y)}}),o.log("[Re-entry] Fading in shader background (--decal-opacity) - fallback")},800))}c()}if(w){const e=n=>{(H||window._isTimelineDismissed)&&(n.preventDefault(),n.stopPropagation(),it())};w.addEventListener("click",e,{capture:!0}),w.addEventListener("touchend",e,{passive:!1,capture:!0}),w.style.pointerEvents="auto"}const ze=document.querySelector(".re-enter-timeline");if(ze){const e=n=>{(H||window._isTimelineDismissed)&&(window.playUIClickSound&&!window.audioMuted&&window.playUIClickSound(),n.preventDefault(),n.stopPropagation(),ze.classList.remove("active"),it())};ze.addEventListener("click",e,{capture:!0}),ze.addEventListener("touchend",e,{passive:!1,capture:!0})}let Ge=!1,nt=-1,ot=0;const Ct=fe()?.003:.001,Pt=fe()?2:1,Ee=e=>{Math.abs(e-nt)<Ct||(ot++,ot%Pt===0&&(nt=e,!Ge&&(Ge=!0,requestAnimationFrame(()=>{Ge=!1,Et()}))))};let Ve=null,Ze=null,Ue=null,_e=null,qe=null;const Et=e=>{Ve||(Ve=document.querySelector(".scrubber-progress")),Ze||(Ze=r.utils.toArray(".marker")),Ue||(Ue=r.utils.toArray(".minor-node"));const n=Ve,s=Ze,m=Ue;if(!n||!_.length)return;const h=s.length;let c=0,f=0,u=-1;if(F.isLocked&&F.targetIndex>=0)c=F.targetIndex,f=(2*c+1)/(2*h);else{const p=Pe,y=p?window.innerHeight/2:window.innerWidth/2;let a=null,E=1/0,M=-1;const X=parseFloat(p?r.getProperty(z,"y")||0:r.getProperty(z,"x")||0),G=W(),V=window.innerWidth,ue=window.innerHeight;if(v.forEach((ie,L)=>{let ne;p?ne=L*ue+ue/2:L===0?ne=V/2:ne=V+(L-1)*G+G/2;const me=ne+X,ae=Math.abs(me-y);ae<E&&(E=ae,a=ie,M=L)}),M!==-1&&(Xe=M),a&&a.classList.contains("timeline-cover"))c=0,u=0,f=1/(2*h),tt();else if(a){u=M-1,u=Math.max(0,Math.min(u,m.length-1));const ie=a.getAttribute("data-year");if(ie&&Tt(ie),u>=0&&m.length>0){const L=m[u];if(L){const ne=parseInt(L.getAttribute("data-decade-index")||"0");c=Math.min(ne,h-1)}else c=0}else c=0}else c=0,u=0,f=1/(2*h),tt()}if(u>=0&&m.length>0){const p=m[u];if(p)if(_e||(_e=document.querySelector(".scrubber-line")),qe||(qe=document.querySelector(".scrubber-content")),_e&&qe){const y=_e.getBoundingClientRect(),a=p.getBoundingClientRect();qe.getBoundingClientRect();const E=a.left+a.width/2-y.left,M=y.width;f=Math.max(0,Math.min(1,E/M))}else f=(2*c+1)/(2*h);else f=(2*c+1)/(2*h)}else f=(2*c+1)/(2*h);if(r.to(n,{scaleX:f,transformOrigin:"left",duration:.3,ease:"power2.out",force3D:!0,overwrite:"auto"}),s.length>0&&s.forEach((p,y)=>{p.classList.remove("active","complete"),y===c?p.classList.add("active"):y<c&&p.classList.add("complete")}),m.length>0&&m.forEach((p,y)=>{p.classList.remove("active","complete");const a=parseInt(p.getAttribute("data-minor-index")||y);a===u?p.classList.add("active"):a<u&&p.classList.add("complete")}),window.scrubberAutoScroll&&!F.isLocked){const p=c>He?1:c<He?-1:0;window.scrubberAutoScroll(c,p),He=c}};window._updateScrubber=Ee;const Rt=e=>{if(e===0)return(.09+ye*.5)/Be;let n=0;for(let f=0;f<e&&f<_.length;f++){const u=r.utils.toArray(".timeline-event",_[f]);n+=u.length}const s=_[e];if(r.utils.toArray(".timeline-event",s).length===0)return o.warn(`Decade ${e} has no events`),0;const h=n-1,c=Ye+h*We+j+ye*.5;return Math.min(c/Be,.99)},ke=(e,n=!1)=>{const s=document.getElementById("timeline-window-start-bg-style");if(!s)return o.warn("[Timeline] Pseudo-element style element not found"),!1;try{return s.textContent=`
        #timeline-window-start::before {
          content: '';
          position: absolute;
          top: -2px;
          left: -6px;
          right: -6px;
          bottom: -2px;
          background: linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164));
          border-radius: 4px;
          opacity: ${e};
          z-index: -1;
          pointer-events: none;
          ${n?"transition: opacity 0.3s ease;":"transition: none !important;"}
        }
      `,!0}catch(m){return o.warn("[Timeline] Failed to update pseudo-element style:",m.message),!1}},De=r.timeline({scrollTrigger:{trigger:w,start:"top 90%",end:"top 70%",scrub:1,onLeaveBack:()=>{ke(0,!1)}}}).to({},{duration:1,ease:"power2.out",onUpdate:function(){try{const n=this.progress()*.5;ke(n)}catch(e){o.warn("[Timeline] Error updating pseudo-element style:",e.message)}}});let R=null;const Ae=[];let H=!1,Re=!1,xe=!1,ve=!1;function Lt(){r.to(l,{opacity:0,duration:.44,ease:"power2.out",onComplete:()=>{Ft()}})}function Ft(){Re=!0,window._isDismissing=!0,H=!0,window._isTimelineDismissed=!0,document.body.classList.remove("in-timeline");const e=document.querySelector("#current-timeline-year");e&&r.to(e,{opacity:0,duration:.44,ease:"power2.out"});const n=document.getElementById("timeline-window-start-bg-style");n&&(n.textContent=`
        #timeline-window-start::before {
          content: '';
          position: absolute;
          top: -2px;
          left: -6px;
          right: -6px;
          bottom: -2px;
          background: linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164));
          border-radius: 4px;
          opacity: 0.5;
          z-index: -1;
          pointer-events: none;
          transition: opacity 0.3s ease;
        }
      `),r.to(i,{opacity:1,duration:.3,ease:"power2.out"}),Ae.forEach(u=>{u&&u.disable&&u.disable()}),Z.getAll().forEach(u=>{(u.vars.trigger===g||u.vars.trigger===i||u.vars.pin===l)&&u.disable()});const s=i.getBoundingClientRect(),m=s.top+window.scrollY,h=window.innerHeight;m-h/2+s.height/2,window.backgroundPaused&&(window.backgroundPaused=!1,window.dispatchEvent(new CustomEvent("timeline:backgroundPaused",{detail:{paused:!1}}))),window.shaderBackgroundRenderer&&window.shaderBackgroundRenderer.setInTimeline&&window.shaderBackgroundRenderer.setInTimeline(!1);const c=document.querySelector("#background-canvas");c&&r.set(c,{opacity:1});const f=document.documentElement;f.style.background="",t.style.cssText=`
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      opacity: 1 !important;
      z-index: 5 !important; /* Behind container (z-index 10) but above other content */
      background: linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164)) !important;
      pointer-events: none !important;
      visibility: visible !important;
      transform: none !important;
      transition: none !important;
    `,g.style.opacity="1",g.style.transition="none",r.to(g,{opacity:0,duration:.44,ease:"power2.inOut",onComplete:()=>{t.style.zIndex="9999",window.lenis?window.lenis.scrollTo(0,{immediate:!0,force:!0,lock:!0}):window.scrollTo(0,0),g.classList.add("closed"),Z.refresh();const u=i.getBoundingClientRect(),p=u.top+window.scrollY,y=window.innerHeight,a=p-y/2+u.height/2;window.lenis?(window.lenis.scrollTo(a,{immediate:!0,force:!0,lock:!0}),window.lenis.resize(),window.lenis.raf(Date.now())):window.scrollTo(0,a),setTimeout(()=>{window.lenis&&window.lenis.resize(),r.to(t,{opacity:0,duration:.44,ease:"power2.inOut",onComplete:()=>{t.style.cssText="",t.style.position="",t.style.top="",t.style.left="",t.style.width="",t.style.height="",t.style.zIndex="",t.style.opacity="",t.style.visibility="",t.style.background="",t.style.pointerEvents="",t.style.transform="",t.style.transition="",t.style.borderRadius="",g.style.pointerEvents="none",document.body.classList.remove("in-timeline"),Re=!1,window._isDismissing=!1;const E=document.querySelector(".re-enter-timeline");E&&E.classList.add("active")}})},100)}})}const st=window.innerHeight*.33,rt=st+600,de=st/rt,Te=r.timeline({scrollTrigger:{trigger:i,start:"center center",end:`+=${rt}`,pin:!0,scrub:fe()?1.5:1,anticipatePin:1,invalidateOnRefresh:!0,onRefresh:e=>{if(H||window._isTimelineDismissed){o.log("[Expansion] onRefresh blocked - timeline is dismissed");return}if(xe){o.log("[Re-entry] onRefresh blocked by isReEntering flag");return}if(ve){o.log("[Re-entry] onRefresh blocked by isBgLockedFullscreen flag");return}if(document.body.classList.contains("in-timeline")){o.log("[Re-entry] onRefresh blocked - already in timeline");return}R=null;const n=de+.01*(1-de),s=D();e.progress>0&&e.progress<n?s&&(t.style.position="fixed",t.style.top=`${s.top}px`,t.style.left=`${s.left}px`,t.style.width=`${s.width}px`,t.style.height=`${s.height}px`,t.style.opacity="0",t.style.visibility="hidden",R={...s}):e.progress>=n&&e.progress<1&&s&&(R={...s})},onUpdate:e=>{if(H||window._isTimelineDismissed||Re||window._isDismissing||xe)return;if(ve){(t.style.top!=="0px"||t.style.left!=="0px"||t.style.width!=="100vw"||t.style.height!=="100vh"||t.style.opacity!=="1")&&(o.log("[Timeline] FULLSCREEN LOCK: Re-locking background at fullscreen"),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.opacity="1",t.style.visibility="visible",t.style.display="block");return}if(document.body.classList.contains("in-timeline")){(t.style.opacity!=="1"||t.style.visibility!=="visible")&&(o.log("[Timeline] onUpdate safety: Forcing background visible (in-timeline)"),t.style.opacity="1",t.style.visibility="visible",t.style.display="block");return}const n=e.progress,s=de+.01*(1-de);if(Math.abs(n-s)<.03){if(!R||R.width===0||R.height===0){const f=D();f?(R={...f},o.log("[Timeline] Critical handoff: Captured fresh position")):o.warn("[Timeline] Critical handoff: Could not get fresh position")}n>=s&&n<s+.02&&((t.style.visibility==="hidden"||t.style.opacity==="0")&&(t.style.visibility="visible",t.style.opacity="0.5",o.log("[Timeline] Critical handoff: Forced BG visible")),ke(0,!1))}const h=Math.max(0,(n-de)/(1-de));n>=de&&h<.1&&(window.timelineShaderControls&&window.timelineShaderControls.resume?(window.timelineShaderControls.resume(),e._loggedShaderResume||(e._loggedShaderResume=!0)):e._loggedShaderMissing||(e._loggedShaderMissing=!0,o.warn("[Timeline] Timeline shader controls not available at progress:",n.toFixed(4))),window.coverOrbControls&&window.coverOrbControls.resume?(window.coverOrbControls.resume(),e._loggedOrbResume||(e._loggedOrbResume=!0)):e._loggedOrbMissing||(e._loggedOrbMissing=!0,o.warn("[Timeline] Cover orb controls not available at progress:",n.toFixed(4)))),document.getElementById("timeline-window-start-bg-style");const c=performance.now();if(c-Je>=Gt){Je=c;const f=t.getBoundingClientRect();if(Math.abs(f.width-window.innerWidth)<10&&Math.abs(f.height-window.innerHeight)<10&&Math.abs(f.top)<10&&Math.abs(f.left)<10){const a=parseFloat(t.style.opacity||"0");Math.abs(a-1)>.01&&(o.log("[Timeline] SAFETY CHECK: Forcing BG to opacity 1 (was",a,")"),t.style.opacity="1",t.style.visibility="visible");return}const p=window.getComputedStyle(w,"::before");parseFloat(p.opacity||"0")>0&&parseFloat(t.style.opacity||"1")>0&&(t.style.opacity="0",t.style.visibility="hidden")}if(n<s){if(document.body.classList.contains("in-timeline"))return;if(c-Je<50){const u=D();u&&(t.style.position="fixed",t.style.top=`${u.top}px`,t.style.left=`${u.left}px`,t.style.width=`${u.width}px`,t.style.height=`${u.height}px`,t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",t.style.borderRadius="4px",t.style.opacity="0",t.style.visibility="hidden",R={...u}),ke(.5,!1)}}else document.body.classList.contains("in-timeline")&&t.style.opacity!=="1"&&(t.style.opacity="1",t.style.visibility="visible",o.log("[Timeline] Forcing background to opacity 1 - already in timeline")),ke(0,!1),t.style.visibility!=="visible"&&(t.style.visibility="visible")},onEnter:()=>{$=!1,P(),De&&De.kill(),ke(.5,!1);const e=D();e?(t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",t.style.borderRadius="4px",t.style.zIndex="0",t.style.opacity="0",t.style.visibility="hidden",R={...e}):o.warn("[Timeline] onEnter: Could not get valid span position")},onLeaveBack:()=>{$=!0,S(),C(),t.style.opacity="0",t.style.visibility="hidden",ke(.5,!0)}}});if(Ae.push(Te.scrollTrigger),Te.fromTo(t,()=>{if(t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))",R&&R.width>0&&R.height>0)return{top:`${R.top}px`,left:`${R.left}px`,width:`${R.width}px`,height:`${R.height}px`};const e=D();if(e)return R={...e},{top:`${e.top}px`,left:`${e.left}px`,width:`${e.width}px`,height:`${e.height}px`};o.warn("[Timeline] No valid position for expansion animation - using viewport center fallback"),window.dispatchEvent(new CustomEvent("timeline:init-failed",{detail:{reason:"expansion-fallback-used",capturedPosition:R,elementExists:!!w,elementDimensions:w?{width:w.offsetWidth,height:w.offsetHeight,display:window.getComputedStyle(w).display}:null,timestamp:Date.now()}}));const n=200,s=40;return{top:`${(window.innerHeight-s)/2}px`,left:`${(window.innerWidth-n)/2}px`,width:`${n}px`,height:`${s}px`}},{top:0,left:0,width:"100vw",height:"100vh",borderRadius:"0px",ease:"power2.inOut",duration:.7,immediateRender:!1,onStart:()=>{const e=D();if(e&&R){const n=Math.abs(e.top-R.top)+Math.abs(e.left-R.left)+Math.abs(e.width-R.width)+Math.abs(e.height-R.height);n>5&&(o.log("[Timeline] Position drift detected on expansion start, syncing:",n.toFixed(1),"px"),t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,R={...e})}},onUpdate:()=>{t.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))"},onReverseComplete:()=>{t.style.opacity="0"}},de),Te.fromTo(t,{opacity:.5},{opacity:1,duration:.7,ease:"none"},de),document.fonts&&document.fonts.ready){let e=!1;const n=()=>{e||(e=!0,Z.refresh())};document.fonts.ready.then(n).catch(s=>{o.warn("[Timeline] Font loading failed, refreshing ScrollTrigger anyway:",s),n()}),setTimeout(()=>{e||(o.warn("[Timeline] Font loading timeout after 3s, forcing ScrollTrigger refresh"),n())},3e3)}else setTimeout(()=>Z.refresh(),500);const It=de+.4*(1-de);Te.to(i,{opacity:0,ease:"power2.in",duration:.6},It);const I={waveSpeed:.26,waveAmplitude:1.9,waveFrequencyX:.16,waveFrequencyY:.32,bobbingAmplitude:1.4,bobbingSpeed:.22,fadeIntensity:.86,opacity:.58,scale:3.4,rotationX:-1.7,rotationZ:.26,positionY:-30,positionZ:-16},te={waveSpeed:.18,waveAmplitude:5,waveFrequencyX:.6,waveFrequencyY:1,bobbingAmplitude:2.2,bobbingSpeed:.24,fadeIntensity:.39,opacity:1,scale:5,rotationX:-1.6,rotationZ:-1.44,positionY:-20,positionZ:-20},K={};let at=0;const Mt=fe()?2:1;let lt=-1;if(k=r.timeline({scrollTrigger:{trigger:g,start:"top top",end:()=>`+=${kt()}`,pin:l,scrub:fe()?1:.2,anticipatePin:1,invalidateOnRefresh:!0,onRefresh:e=>{if(H||window._isTimelineDismissed){o.log("[Timeline] Timeline onRefresh blocked - timeline is dismissed");return}if(!(Re||window._isDismissing||xe)){if(ve){o.log("[Timeline] Timeline onRefresh blocked by isBgLockedFullscreen flag"),e.animation&&Ee(e.animation.progress());return}if(document.body.classList.contains("in-timeline")){o.log("[Timeline] Timeline onRefresh - in timeline, skipping background updates"),e.animation&&Ee(e.animation.progress());return}e.animation&&(Ee(e.animation.progress()),Ee(e.animation.progress()))}},onUpdate:e=>{if(H||window._isTimelineDismissed||Re||window._isDismissing||xe||ve)return;const n=e.animation.progress();Ee(n);const s=.75;if(!fe()&&n>s&&window.timelineShaderControls&&window.timelineShaderControls.updateParams){at++;const m=Math.abs(n-lt);if(!(at%Mt===0||m>.01))return;lt=n;let c=(n-s)/(1-s);c=Math.max(0,Math.min(1,c)),K.waveSpeed=I.waveSpeed+(te.waveSpeed-I.waveSpeed)*c,K.waveAmplitude=I.waveAmplitude+(te.waveAmplitude-I.waveAmplitude)*c,K.waveFrequencyX=I.waveFrequencyX+(te.waveFrequencyX-I.waveFrequencyX)*c,K.waveFrequencyY=I.waveFrequencyY+(te.waveFrequencyY-I.waveFrequencyY)*c,K.bobbingAmplitude=I.bobbingAmplitude+(te.bobbingAmplitude-I.bobbingAmplitude)*c,K.bobbingSpeed=I.bobbingSpeed+(te.bobbingSpeed-I.bobbingSpeed)*c,K.fadeIntensity=I.fadeIntensity+(te.fadeIntensity-I.fadeIntensity)*c,K.opacity=I.opacity+(te.opacity-I.opacity)*c,K.scale=I.scale+(te.scale-I.scale)*c,K.rotationX=I.rotationX+(te.rotationX-I.rotationX)*c,K.rotationZ=I.rotationZ+(te.rotationZ-I.rotationZ)*c,K.positionY=I.positionY+(te.positionY-I.positionY)*c,K.positionZ=I.positionZ+(te.positionZ-I.positionZ)*c,window.timelineShaderControls.updateParams(K)}},onEnter:()=>{if(H||window._isTimelineDismissed){o.log("[Timeline] onEnter blocked - timeline is dismissed");return}document.body.classList.add("in-timeline");const e=document.querySelector('meta[name="theme-color"]');e&&e.setAttribute("content","#000000"),window.backgroundPaused||(window.backgroundPaused=!0,window.dispatchEvent(new CustomEvent("timeline:backgroundPaused",{detail:{paused:!0}}))),window.shaderBackgroundRenderer&&window.shaderBackgroundRenderer.setInTimeline&&window.shaderBackgroundRenderer.setInTimeline(!0),window.coverOrbControls&&window.coverOrbControls.resume&&window.coverOrbControls.resume(),window.timelineShaderControls&&window.timelineShaderControls.resume&&window.timelineShaderControls.resume(),window._timelinePauseTimeout&&(clearTimeout(window._timelinePauseTimeout),window._timelinePauseTimeout=null),r.set(l,{opacity:1,display:"block",pointerEvents:"auto",visibility:"visible"}),z&&r.set(z,{opacity:1,visibility:"visible",clearProps:fe()?"x":"y"}),r.utils.toArray(".timeline-event").forEach(p=>{r.set(p,{visibility:"visible",display:"flex"})});const s=document.querySelector(".timeline-event.timeline-cover");s&&r.set(s,{opacity:1,scale:1,visibility:"visible"}),t.style.zIndex="0",r.to(t,{opacity:1,duration:.2,ease:"none",overwrite:"auto"});const m=document.querySelector("#background-canvas");m&&r.to(m,{opacity:0,duration:.5,ease:"power2.inOut"});const h=document.documentElement;h.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))";const c=r.utils.toArray(".minor-node"),f=r.utils.toArray(".marker"),u=document.querySelector(".scrubber-progress");if(c.length>0&&u){const p=c[0];c.forEach(a=>{a.classList.remove("active","complete")}),p.classList.add("active"),f.length>0&&(f.forEach(a=>{a.classList.remove("active","complete")}),f[0].classList.add("active"));const y=document.querySelector(".scrubber-line");if(y){const a=y.getBoundingClientRect(),E=p.getBoundingClientRect(),M=E.left+E.width/2-a.left,X=a.width,G=Math.max(0,Math.min(1,M/X));r.set(u,{scaleX:G,transformOrigin:"left"})}}A||(A=document.querySelector("#current-timeline-year")),A&&(r.set(A,{opacity:0}),A.textContent="",B&&typeof B.revert=="function"&&(B.revert(),B=null),Me=null,he=!1)},onLeave:()=>{document.body.classList.remove("in-timeline"),window.backgroundPaused&&(window.backgroundPaused=!1,window.dispatchEvent(new CustomEvent("timeline:backgroundPaused",{detail:{paused:!1}}))),window.shaderBackgroundRenderer&&window.shaderBackgroundRenderer.setInTimeline&&window.shaderBackgroundRenderer.setInTimeline(!1);const e=document.querySelector("#background-canvas");e&&r.to(e,{opacity:1,duration:.5,ease:"power2.inOut"});const n=document.documentElement;r.to(n,{duration:.5,ease:"power2.inOut",onComplete:function(){n.style.background=""}})},onLeaveBack:()=>{document.body.classList.remove("in-timeline"),window.backgroundPaused&&(window.backgroundPaused=!1,window.dispatchEvent(new CustomEvent("timeline:backgroundPaused",{detail:{paused:!1}}))),window.shaderBackgroundRenderer&&window.shaderBackgroundRenderer.setInTimeline&&window.shaderBackgroundRenderer.setInTimeline(!1);const e=setTimeout(()=>{document.body.classList.contains("in-timeline")||(window.coverOrbControls&&window.coverOrbControls.pause&&window.coverOrbControls.pause(),window.timelineShaderControls&&window.timelineShaderControls.stop&&window.timelineShaderControls.stop())},1e3);window._timelinePauseTimeout=e,A||(A=document.querySelector("#current-timeline-year")),A&&(r.set(A,{opacity:0}),A.textContent="",B&&typeof B.revert=="function"&&(B.revert(),B=null),Me=null,he=!1)},onEnterBack:()=>{if(H||window._isTimelineDismissed){o.log("[Timeline] onEnterBack blocked - timeline is dismissed");return}document.body.classList.add("in-timeline"),window.backgroundPaused||(window.backgroundPaused=!0,window.dispatchEvent(new CustomEvent("timeline:backgroundPaused",{detail:{paused:!0}}))),window.shaderBackgroundRenderer&&window.shaderBackgroundRenderer.setInTimeline&&window.shaderBackgroundRenderer.setInTimeline(!0),window.coverOrbControls&&window.coverOrbControls.resume&&window.coverOrbControls.resume(),window.timelineShaderControls&&window.timelineShaderControls.resume&&window.timelineShaderControls.resume(),window._timelinePauseTimeout&&(clearTimeout(window._timelinePauseTimeout),window._timelinePauseTimeout=null),r.set(l,{opacity:1,display:"block",pointerEvents:"auto",visibility:"visible"}),z&&r.set(z,{opacity:1,visibility:"visible"}),r.utils.toArray(".timeline-event").forEach(m=>{r.set(m,{visibility:"visible",display:"flex"})}),t.style.zIndex="0",r.to(t,{opacity:1,duration:.2,ease:"none",overwrite:"auto"});const n=document.querySelector("#background-canvas");n&&r.to(n,{opacity:0,duration:.5,ease:"power2.inOut"});const s=document.documentElement;s.style.background="linear-gradient(rgb(4, 147, 171), rgb(6, 87, 164))"}}}),Ae.push(k.scrollTrigger),k.fromTo(".timeline-scrubber",{opacity:0,y:30},{opacity:1,y:0,duration:.05,ease:"power2.out",force3D:!0},0),k.to(".scrubber-nav",{opacity:1,duration:.05,ease:"power2.out",force3D:!0},0),k.to(t,{"--decal-opacity":1,duration:.5,ease:"power2.out",onUpdate:function(){const e=r.getProperty(t,"--decal-opacity")||0;t.style.setProperty("--decal-opacity",e)}},.01),v.length>0){const e=v[0],n=v.slice(1),s="first-event";k.add(s,0),k.fromTo(e,{opacity:0,scale:.95},{opacity:1,scale:1,duration:.25,ease:"power2.out",force3D:!0},s),Qe(e,s,j*.05),k.to({},{duration:ye},">"),n.forEach((m,h)=>{const c=()=>Pe,f=()=>{if(c())return 0;const a=W(),E=window.innerWidth,M=window.innerWidth*.5,X=E+h*a+a*.5;return M-X},u=()=>c()?`${-(h+1)*100}vh`:0,p=`event-${h}`;k.to(z,{x:f,y:u,duration:j,ease:"power1.inOut",force3D:!0},p);const y=h===0?e:n[h-1];k.to(y,{opacity:0,scale:.94,duration:j*.28,ease:"power1.in",force3D:!0},`${p}+=${j*.34}`),k.fromTo(m,{opacity:0,scale:.9},{opacity:1,scale:1,duration:j*1.15,ease:"power2.out",force3D:!0},`${p}+=${j*.1}`),Qe(m,p,j*.12),h===0&&k.fromTo(".timeline-close",{opacity:0},{opacity:1,duration:j*.5,ease:"power2.out",force3D:!0},`${p}+=${j*.3}`),k.to({},{duration:ye})})}const ct=g.querySelector(".timeline-close");ct&&ct.addEventListener("click",()=>{Lt()});function dt(){const e=r.utils.toArray(".marker");if(!e.length||!_.length){o.warn("Timeline: Markers or decades not found");return}let n=0,s=0;_.forEach((m,h)=>{const c=m.getAttribute("data-decade"),f=r.utils.toArray(".timeline-event",m),u=e.find(a=>a.getAttribute("data-decade")===c);if(!u){o.warn(`Timeline: No marker found for decade ${c}`);return}const p=u.querySelector(".marker-minor-nodes");if(!p){o.warn(`Timeline: No minor nodes container found for decade ${c}`);return}p.innerHTML="";const y=parseInt(c)||0;f.forEach((a,E)=>{if(a.classList.contains("timeline-cover")){n++;return}const X=n===0?(.09+ye*.5)/Be:(Ye+(n-1)*We+j+ye*.5)/Be,G=a.getAttribute("data-year")||"";let V=0;const ue=G.match(/\d{4}/);ue&&(V=parseInt(ue[0]));let ie=0;V>0&&y>0&&(ie=(V-y)/10,ie=Math.max(0,Math.min(.95,ie)));const L=document.createElement("div");L.className="minor-node",L.setAttribute("data-event-index",n),L.setAttribute("data-minor-index",s),L.setAttribute("data-decade-index",h),L.setAttribute("data-local-index",E),L.setAttribute("data-year",G),L.setAttribute("data-year-numeric",V.toString()),L.setAttribute("data-year-position",ie.toFixed(3));const ne=document.createElement("div");if(ne.className="minor-node-dot",L.appendChild(ne),G){const me=document.createElement("div");me.className="minor-node-label",me.textContent=G,L.appendChild(me)}requestAnimationFrame(()=>{const me=u.getBoundingClientRect(),ae=r.utils.toArray(".marker"),je=h+1;if(je<ae.length){const Ce=ae[je].getBoundingClientRect(),Le=me.right,Fe=Ce.left-Le,Se=30,Y=20,le=Fe-Se-Y,Oe=Se+Y+le*ie;L.style.left=`${Oe}px`}else{const be=window.innerWidth,Ce=be>768?120:100,Le=be>768?5:be<640?2:4,Ke=(be-Ce)/Le,Fe=30,Se=20,Y=Ke-Fe-Se,le=Fe+Se+Y*ie;L.style.left=`${le}px`}}),L.addEventListener("click",me=>{me.stopPropagation(),F.isLocked=!0,F.reason="minor-node-click",F.unlockTimer&&clearTimeout(F.unlockTimer),r.utils.toArray(".minor-node").forEach(Y=>{Y.classList.remove("active","complete");const le=parseInt(Y.getAttribute("data-minor-index")||"0");le<s?Y.classList.add("complete"):le===s&&Y.classList.add("active")}),r.utils.toArray(".marker").forEach((Y,le)=>{Y.classList.remove("active","complete"),le===h?Y.classList.add("active"):le<h&&Y.classList.add("complete")});const be=document.querySelector(".scrubber-progress");if(be){const Y=document.querySelector(".scrubber-line");if(Y){const le=Y.getBoundingClientRect(),Oe=L.getBoundingClientRect(),At=Oe.left+Oe.width/2-le.left,Bt=le.width,zt=Math.max(0,Math.min(1,At/Bt));r.to(be,{scaleX:zt,transformOrigin:"left",duration:.3,ease:"power2.out"})}}const Ce=k.scrollTrigger;if(!Ce)return;const Le=Ce.start,Fe=Ce.end-Le,Se=Le+Fe*X;window.lenis?window.lenis.scrollTo(Se,{duration:1,easing:Y=>Math.min(1,1.001-Math.pow(2,-10*Y)),onComplete:()=>{F.unlockTimer=setTimeout(()=>{F.isLocked=!1,F.targetIndex=-1,F.reason=""},500)}}):(window.scrollTo({top:Se,behavior:"smooth"}),F.unlockTimer=setTimeout(()=>{F.isLocked=!1,F.targetIndex=-1,F.reason=""},1500))}),p.appendChild(L),n++,s++}),f.filter(a=>!a.classList.contains("timeline-cover")).length})}dt(),window._generateMinorNodes=dt;function Dt(){const e=document.querySelector(".scrubber-scroll-wrapper"),n=document.querySelector(".scrubber-nav-prev"),s=document.querySelector(".scrubber-nav-next"),m=r.utils.toArray(".marker");if(!e||!n||!s){o.warn("Timeline: Scrubber scroll elements not found");return}function h(){const a=e.scrollLeft,E=e.scrollWidth-e.clientWidth;a<=10?n.classList.add("disabled"):n.classList.remove("disabled"),a>=E-10?s.classList.add("disabled"):s.classList.remove("disabled")}function c(a){if(a<0||a>=m.length)return;const E=m[a],M=E.getBoundingClientRect();e.getBoundingClientRect();const X=E.offsetLeft+M.width/2,G=e.clientWidth/2,V=X-G;e.scrollTo({left:Math.max(0,V),behavior:"smooth"})}function f(a){const E=window.innerWidth,M=E>768?120:100,X=E>768?5:E<640?2:4,V=((E-M)/X+60)*3,ue=e.scrollLeft+V*a;e.scrollTo({left:Math.max(0,ue),behavior:"smooth"})}n.addEventListener("click",()=>{f(-1)}),s.addEventListener("click",()=>{f(1)}),e.addEventListener("scroll",h),h();let u=!1,p,y;e.style.cursor="",e.style.userSelect="none",e.addEventListener("mousedown",a=>{u=!0,e.classList.add("active"),e.style.cursor="grabbing",p=a.pageX-e.offsetLeft,y=e.scrollLeft}),e.addEventListener("mouseleave",()=>{u=!1,e.classList.remove("active"),e.style.cursor=""}),e.addEventListener("mouseup",()=>{u=!1,e.classList.remove("active"),e.style.cursor=""}),e.addEventListener("mousemove",a=>{if(!u)return;a.preventDefault();const M=(a.pageX-e.offsetLeft-p)*1.5;e.scrollLeft=y-M}),window.scrubberAutoScroll=(a,E=0)=>{if(a<0||a>=m.length)return;const X=m[a].getBoundingClientRect(),G=e.getBoundingClientRect(),V=G.left+100,ue=G.right-100,ie=X.left>=V&&X.right<=ue;let L=!1,ne=a;if(!ie)L=!0;else if(E>0){if(a+1<m.length){const ae=m[a+1].getBoundingClientRect();(ae.right>ue||ae.left>ue)&&(L=!0,ne=a+1)}}else if(E<0&&a-1>=0){const ae=m[a-1].getBoundingClientRect();(ae.left<V||ae.right<V)&&(L=!0,ne=a-1)}L&&c(ne)}}return Dt(),r.utils.toArray(".marker").forEach((e,n)=>{e.addEventListener("click",()=>{F.isLocked=!0,F.targetIndex=n,F.reason="click",F.unlockTimer&&clearTimeout(F.unlockTimer),F.unlockTimer=setTimeout(()=>{F.isLocked=!1,F.targetIndex=-1,F.reason=""},100);const s=Rt(n),m=k.scrollTrigger;if(!m)return;const h=m.start,f=m.end-h,u=h+f*s;window.lenis?window.lenis.scrollTo(u,{duration:1.2,easing:p=>Math.min(1,1.001-Math.pow(2,-10*p))}):window.scrollTo({top:u,behavior:"smooth"})}),e.style.cursor="pointer"}),r.timeline({scrollTrigger:{trigger:g,start:"bottom bottom",end:"bottom 80%",scrub:1,onEnterBack:()=>{r.to([t,g],{opacity:1,duration:.3})},onLeave:()=>{}}}).to([t,g],{opacity:0,ease:"power2.in"}),Z.addEventListener("refreshInit",()=>{}),Z.addEventListener("refresh",()=>{if(Xe>0){const n=`event-${Xe-1}`;if(k.labels[n]!==void 0){const h=(k.labels[n]+j)/k.duration(),c=k.scrollTrigger;if(c){const f=c.start+h*(c.end-c.start);window.scrollTo(0,f)}}}}),window._timelineCleanup={rafId:U,resizeObserver:se,stopTracking:P},window._timelineScrollTriggers=Ae.slice(),ee&&window._timelineScrollTriggers.push(ee),De&&De.scrollTrigger&&window._timelineScrollTriggers.push(De.scrollTrigger),Te&&Te.scrollTrigger&&window._timelineScrollTriggers.push(Te.scrollTrigger),k&&k.scrollTrigger&&window._timelineScrollTriggers.push(k.scrollTrigger),window._timelinePositioning={positionBgToSpan:C,syncBgToSpanImmediate:S,resetCapturedPosition:()=>{R=null,T={top:0,left:0,width:0,height:0},b={top:0,left:0,width:0,height:0}},setTrackingSpan:e=>{$=e},getTrackingSpan:()=>$},k.scrollTrigger&&(x.timelineScrollTrigger=k.scrollTrigger),x.markerLockRef=F,requestAnimationFrame(()=>{Z.refresh()}),k}let x={isResizing:!1,savedProgress:null,timelineScrollTrigger:null,markerLockRef:null};function Vt(){const d=typeof x<"u"&&x?x.timelineScrollTrigger:null;if(!d||!d.isActive)return null;const g=d.progress,w=r.utils.toArray(".timeline-event"),t=r.utils.toArray(".timeline-decade"),i=r.utils.toArray(".marker");let l=0,z=0,T=-1;i.forEach(($,q)=>{$.classList.contains("active")&&(T=q)});const b=w.length;if(b>0&&g>0){l=Math.min(Math.floor(g*b),b-1);let $=0;for(let q=0;q<t.length;q++){const D=r.utils.toArray(".timeline-event",t[q]);if(l<$+D.length){z=q;break}$+=D.length}}return T>=0&&(z=T),{progress:g,activeEventIndex:l,activeDecadeIndex:z,activeMarkerIndex:T,scrollPosition:window.pageYOffset||document.documentElement.scrollTop}}let ut=null,mt=null,pt=window.innerWidth,gt=window.innerHeight;function Zt(){x.isResizing||(x.isResizing=!0,x.savedProgress=Vt(),document.body.classList.add("timeline-resizing"))}function Ut(){const d=window.innerWidth,g=window.innerHeight,w=Math.abs(d-pt),t=Math.abs(g-gt),i=w<5&&t>40&&t<200;return pt=d,gt=g,i}function jt(){const d=Ut(),g=document.querySelector("#timeline-shader-bg");g&&(g.style.width=`${window.innerWidth}px`,g.style.height=`${window.innerHeight}px`),window._generateMinorNodes&&!d&&window._generateMinorNodes();const w=document.querySelector("#acs-timeline");if(w&&window._timelinePositioning){const t=document.body.classList.contains("in-timeline"),l=w.getBoundingClientRect().top>window.innerHeight*.3;!t&&l?(o.log("[Resize] Before timeline - resetting background position"),window._timelinePositioning.resetCapturedPosition(),window._timelinePositioning.setTrackingSpan&&window._timelinePositioning.setTrackingSpan(!0),requestAnimationFrame(()=>{window._timelinePositioning.syncBgToSpanImmediate&&window._timelinePositioning.syncBgToSpanImmediate()})):t||requestAnimationFrame(()=>{window._timelinePositioning.syncBgToSpanImmediate&&window._timelinePositioning.syncBgToSpanImmediate()})}if(d){o.log("[Resize] Mobile address bar change detected - lightweight refresh"),Z.update(),requestAnimationFrame(()=>{window._timelinePositioning&&window._timelinePositioning.syncBgToSpanImmediate&&window._timelinePositioning.syncBgToSpanImmediate(),document.body.classList.remove("timeline-resizing"),x.isResizing=!1,x.savedProgress=null});return}Z.refresh(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Z.update(),w&&window._timelinePositioning){const t=document.body.classList.contains("in-timeline"),l=w.getBoundingClientRect().top>window.innerHeight*.3;!t&&l&&(o.log("[Resize] Post-refresh: Re-syncing background position"),window._timelinePositioning.syncBgToSpanImmediate&&window._timelinePositioning.syncBgToSpanImmediate())}if(x.savedProgress&&x.timelineScrollTrigger){const t=x.timelineScrollTrigger,i=t.start,z=t.end-i,T=i+z*x.savedProgress.progress;if(window.lenis?window.lenis.scrollTo(T,{immediate:!0,force:!0}):window.scrollTo({top:T,behavior:"auto"}),x.savedProgress.activeMarkerIndex>=0&&x.markerLockRef){x.markerLockRef.isLocked=!0,x.markerLockRef.targetIndex=x.savedProgress.activeMarkerIndex,x.markerLockRef.reason="resize",r.utils.toArray(".marker").forEach((C,O)=>{C.classList.remove("active","complete"),O===x.savedProgress.activeMarkerIndex?C.classList.add("active"):O<x.savedProgress.activeMarkerIndex&&C.classList.add("complete")});const $=x.savedProgress.activeEventIndex,q=r.utils.toArray(".minor-node"),D=$-1;q.forEach((C,O)=>{C.classList.remove("active","complete");const N=parseInt(C.getAttribute("data-minor-index")||O);N===D?C.classList.add("active"):N<D&&C.classList.add("complete")});const S=document.querySelector(".scrubber-progress");if(S&&D>=0&&q[D]){const C=q[D],O=document.querySelector(".scrubber-line");O&&C&&requestAnimationFrame(()=>{const N=O.getBoundingClientRect(),oe=C.getBoundingClientRect(),J=oe.left+oe.width/2-N.left,se=N.width,U=Math.max(0,Math.min(1,J/se));r.set(S,{scaleX:U,transformOrigin:"left"})})}}setTimeout(()=>{Z.update(),t.animation&&(t.animation.invalidate(),t.animation.progress(t.animation.progress())),window.dispatchEvent(new Event("scroll")),t.animation&&window._updateScrubber&&requestAnimationFrame(()=>{window._updateScrubber(t.animation.progress())}),setTimeout(()=>{x.markerLockRef&&x.markerLockRef.reason==="resize"&&(x.markerLockRef.isLocked=!1,x.markerLockRef.targetIndex=-1,x.markerLockRef.reason="")},500),document.body.classList.remove("timeline-resizing"),x.isResizing=!1,x.savedProgress=null},150)}else document.body.classList.remove("timeline-resizing"),x.isResizing=!1,x.savedProgress=null})})}window.addEventListener("resize",()=>{clearTimeout(mt),clearTimeout(ut),mt=setTimeout(Zt,10),ut=setTimeout(jt,300)});if(window.visualViewport){let d=null;window.visualViewport.addEventListener("resize",()=>{clearTimeout(d),d=setTimeout(()=>{!x.isResizing&&window._timelinePositioning&&(document.body.classList.contains("in-timeline")||(o.log("[VisualViewport] Address bar change - syncing background"),window._timelinePositioning.setTrackingSpan&&window._timelinePositioning.setTrackingSpan(!0),window._timelinePositioning.syncBgToSpanImmediate&&window._timelinePositioning.syncBgToSpanImmediate()))},100)})}function si(){try{if(window._timelineCleanup){if(window._timelineCleanup.rafId&&cancelAnimationFrame(window._timelineCleanup.rafId),window._timelineCleanup.resizeObserver)try{window._timelineCleanup.resizeObserver.disconnect()}catch(d){o.warn("[Timeline] Error disconnecting resize observer:",d.message)}if(window._timelineCleanup.lenisCallback&&window.lenis)try{window.lenis.off("scroll",window._timelineCleanup.lenisCallback)}catch(d){o.warn("[Timeline] Error removing lenis listener:",d.message)}if(window._timelineCleanup.scrollCallback&&window.removeEventListener("scroll",window._timelineCleanup.scrollCallback),window._timelineCleanup.stopTracking)try{window._timelineCleanup.stopTracking()}catch(d){o.warn("[Timeline] Error stopping tracking:",d.message)}window._timelineCleanup=null}if(window._timelineScrollTriggers&&(window._timelineScrollTriggers.forEach(d=>{try{d&&d.kill&&d.kill()}catch(g){o.warn("[Timeline] Error killing ScrollTrigger:",g.message)}}),window._timelineScrollTriggers=null),window.timelineShaderControls){try{window.timelineShaderControls.stop&&window.timelineShaderControls.stop(),window.timelineShaderControls.dispose&&window.timelineShaderControls.dispose()}catch(d){o.warn("[Timeline] Error disposing shader:",d.message)}window.timelineShaderControls=null}if(window.coverOrbControls){try{window.coverOrbControls.dispose&&window.coverOrbControls.dispose()}catch(d){o.warn("[Timeline] Error disposing cover orb:",d.message)}window.coverOrbControls=null}window._isTimelineDismissed=!1,window._isDismissing=!1,window.backgroundPaused&&(window.backgroundPaused=!1,window.dispatchEvent(new CustomEvent("timeline:backgroundPaused",{detail:{paused:!1}}))),o.log("[Timeline] Disposed successfully")}catch(d){o.warn("[Timeline] Error during dispose:",d.message)}}export{si as disposeTimeline,oi as initTimelineAnimation,Pe as isMobileBreakpoint};
