import{l as t}from"./logger-2Ii2FPkr.js";class f{constructor(){this.isAuthorMode=!1,this.isEditMode=!1,this.isPreviewMode=!1,this.isPublishMode=!0,this.detected=!1}isDevelopmentEnvironment(){const e=window.location.hostname,s=["localhost","127.0.0.1","0.0.0.0",".local","dev.","test.","staging."],o=window.location.port,i=["3000","4200","5173","8080","8000","9000"];return!!(s.some(r=>e.includes(r))||i.includes(o))}detect(){if(this.detected)return this.getMode();if(this.isDevelopmentEnvironment())return t.log("[AEM Mode Detector] Development environment detected - skipping AEM detection"),this.isPublishMode=!0,this.isAuthorMode=!1,this.isEditMode=!1,this.isPreviewMode=!1,this.detected=!0,"publish";const e=window.location.href,s=window.location.pathname,o=window.location.hostname;if(e.includes("wcmmode=disabled"))return t.log("[AEM Mode Detector] wcmmode=disabled detected - using publish mode"),this.isPublishMode=!0,this.isAuthorMode=!1,this.isEditMode=!1,this.isPreviewMode=!1,this.detected=!0,"publish";const i=o.includes("adobeaemcloud.com")||o.includes("aem")||o.includes("author")||o.includes("publish"),r=e.includes("/editor.html/")||s.includes("/editor.html/")||e.includes("/cf#/"),c=e.includes("wcmmode=edit")||e.includes("wcmmode=design"),u=e.includes("wcmmode=preview");(r||c)&&(i||s.includes("/content/"))&&(this.isAuthorMode=!0,this.isPublishMode=!1,this.isEditMode=!0,t.log("[AEM Mode Detector] Edit mode detected via URL")),u&&(i||s.includes("/content/"))&&(this.isAuthorMode=!0,this.isPublishMode=!1,this.isPreviewMode=!0,t.log("[AEM Mode Detector] Preview mode detected via URL")),typeof window.Granite<"u"&&i&&!this.isEditMode&&!this.isPreviewMode&&(this.isAuthorMode=!0,this.isPublishMode=!1,t.log("[AEM Mode Detector] Granite namespace detected (author environment)"));const h=document.querySelector(".aem-AuthorLayer-Edit")||document.body.classList.contains("aem-AuthorLayer-Edit"),M=document.querySelector(".granite-author-layer");h&&(i||r)?(this.isAuthorMode=!0,this.isEditMode=!0,this.isPublishMode=!1,t.log("[AEM Mode Detector] AEM Edit UI elements detected")):M&&i&&!this.isEditMode&&(this.isAuthorMode=!0,this.isPublishMode=!1,t.log("[AEM Mode Detector] AEM Author UI detected (not edit mode)"));const m=document.cookie.split(";");for(let d of m){const[a,l]=d.trim().split("=");if(a==="wcmmode"&&(i||r)){if(l==="disabled"){this.isPublishMode=!0,this.isAuthorMode=!1,this.isEditMode=!1,this.isPreviewMode=!1,t.log("[AEM Mode Detector] wcmmode=disabled cookie - using publish mode");break}else l==="edit"||l==="design"?(this.isAuthorMode=!0,this.isEditMode=!0,this.isPublishMode=!1,t.log("[AEM Mode Detector] wcmmode=edit/design cookie detected")):l==="preview"&&(this.isAuthorMode=!0,this.isPreviewMode=!0,this.isPublishMode=!1,t.log("[AEM Mode Detector] wcmmode=preview cookie detected"));break}}try{if(window.self!==window.top&&!this.isEditMode){const d=document.referrer;(d.includes("/editor.html/")||d.includes("adobeaemcloud.com")&&d.includes("/editor.html/"))&&(this.isAuthorMode=!0,this.isEditMode=!0,this.isPublishMode=!1,t.log("[AEM Mode Detector] AEM Editor iframe detected"))}}catch{this.isEditMode&&i&&t.log("[AEM Mode Detector] Cross-origin iframe in edit context")}this.detected=!0;const n=this.getMode();return t.log("[AEM Mode Detector] Detection complete:",{mode:n,url:e,hostname:o,isAuthorMode:this.isAuthorMode,isEditMode:this.isEditMode,isPreviewMode:this.isPreviewMode,isPublishMode:this.isPublishMode,isDevelopment:this.isDevelopmentEnvironment()}),n}getMode(){return this.isEditMode?"edit":this.isPreviewMode?"preview":this.isAuthorMode?"author":"publish"}shouldUseFallbackMode(){return this.detected||this.detect(),this.isEditMode}shouldUseLimitedMode(){return this.detected||this.detect(),this.isAuthorMode&&!this.isEditMode}isFullFeatureMode(){return this.detected||this.detect(),this.isPublishMode}getSettings(){return this.detected||this.detect(),this.shouldUseFallbackMode()?{mode:"fallback",enableBackground:!1,enableAnimations:!1,enableVideo:!1,enableParticles:!1,enableMouseParticles:!1,enableAudio:!1,enableScrollEffects:!1,showStaticBackground:!0,showPlaceholderMessage:!0}:this.shouldUseLimitedMode()?{mode:"limited",enableBackground:!0,enableAnimations:!0,enableVideo:!0,enableParticles:!0,enableMouseParticles:!0,enableAudio:!1,enableScrollEffects:!0,showStaticBackground:!1,showPlaceholderMessage:!1}:{mode:"full",enableBackground:!0,enableAnimations:!0,enableVideo:!0,enableParticles:!0,enableMouseParticles:!0,enableAudio:!0,enableScrollEffects:!0,showStaticBackground:!1,showPlaceholderMessage:!1}}applyStaticBackground(){const e=document.body,s=document.getElementById("shaderBackground");s&&(s.style.display="none"),e.style.background="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",e.style.backgroundAttachment="fixed",t.log("[AEM Mode] Applied static background")}showPlaceholderMessage(){if(document.getElementById("aem-edit-mode-message"))return;const e=document.createElement("div");e.id="aem-edit-mode-message",e.style.cssText=`
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      z-index: 999999;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    `,e.innerHTML=`
      <strong>⚠️ AEM Edit Mode</strong><br>
      <small style="opacity: 0.8;">Heavy visuals disabled to prevent memory issues.<br>
      Preview on publish for full experience.</small>
    `,document.body.appendChild(e),t.log("[AEM Mode] Showing edit mode message")}}const E=new f;export{E as default};
