import{l as t}from"./logger-2Ii2FPkr.js";const se=document.querySelector('script[src*="/content/dam/acsorg/150/"]')!==null,ee=se?"/content/dam/acsorg/150/assets":"",le=`${ee}/video/acs-150-compressed-3.mp4`,ue=`${ee}/images/ACS150-promo-cover.jpg`,ce=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ge=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,v=ce||ge;v&&console.log("[video.js] Safari/iOS detected - will use Safari-specific video handling");let N=!1,E=null,R=!1,j=!1;function me(a){try{if(j){t.log("YouTube player already initialized, skipping"),a&&a();return}if(window.YT&&window.YT.Player){t.log("YouTube API already loaded, initializing player immediately"),M(),a&&a();return}if(window.onYouTubeIframeAPIReady){t.log("YouTube API is loading, chaining our callback");const e=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{try{typeof e=="function"&&e()}catch(f){t.warn("Error in chained onYouTubeIframeAPIReady callback:",f)}j||M(),a&&a()};return}t.log("Loading YouTube API for the first time");const s=document.createElement("script");s.src="https://www.youtube.com/iframe_api";const m=document.getElementsByTagName("script")[0];m&&m.parentNode?m.parentNode.insertBefore(s,m):document.head.appendChild(s),window.onYouTubeIframeAPIReady=()=>{t.log("YouTube API ready, initializing player"),j||M(),a&&a()}}catch(s){t.error("Error in initYouTubeAPI:",s),a&&a()}}function fe(){if(R){t.log("YouTube iframe already loaded, skipping");return}const a=document.getElementById("youtube-video-iframe");if(a){if(a.src&&a.src!=="about:blank"&&a.src!==""){t.log("YouTube iframe already has src, marking as loaded"),R=!0;return}a.dataset.src&&(t.log("Lazy loading YouTube iframe from data-src"),a.src=a.dataset.src,R=!0)}}let Y=!1;function M(){if(j){t.log("YouTube player already initialized (initPlayer check), skipping");return}const a=document.getElementById("youtube-video-iframe");if(!a||!document.body.contains(a)){t.warn("YouTube iframe not found or not in DOM, delaying player init"),setTimeout(M,100);return}if(!a.src||a.src==="about:blank"){t.warn("YouTube iframe src not set, delaying player init"),setTimeout(M,100);return}j=!0,a.setAttribute("data-player-managed","true"),a.setAttribute("data-yt-player-initialized","true"),window.mainYouTubePlayerManaged=!0,window.mainYouTubePlayerInitializing=!0;try{E=new YT.Player("youtube-video-iframe",{events:{onReady:ve,onStateChange:ye}}),window.isMainVideoPlaying=()=>{try{return Y&&E&&E.getPlayerState&&E.getPlayerState()===1}catch{return!1}},window.isMainYouTubePlayerReady=()=>Y}catch(s){t.error("Error creating YouTube player:",s),j=!1,window.mainYouTubePlayerManaged=!1}}function I(){const a=document.getElementById("youtube-video-wrapper");if(!a)return;a.querySelectorAll("div:not(.video-start-overlay):not(.play-button-overlay)").forEach(m=>{const e=m.style;e.position==="absolute"&&e.top==="0px"&&e.left==="0px"&&e.width==="100%"&&e.height==="100%"&&!m.classList.length&&(t.log("Removing YouTube blocking div"),m.remove())})}function ve(a){t.log("YouTube player ready"),Y=!0,window.mainYouTubePlayerInitializing=!1,window.mainYouTubePlayerReady=!0,I(),setTimeout(I,500),setTimeout(I,1e3)}function ye(a){if(!Y){t.warn("Player state change received but player not ready yet");return}t.log("Main video state changed:",a.data),a.data===1?(I(),t.log("[video.js] Video playing, pausing background audio"),window.cancelActiveFade&&window.cancelActiveFade(),window.backgroundAudio&&(window.fadeBackgroundAudio?window.fadeBackgroundAudio(.001,1e3,()=>{t.log("[video.js] Background audio ducked (vol 0.001)")}):window.backgroundAudio.volume=.001)):(a.data===0||a.data===2)&&(t.log("[video.js] Video paused/ended, calling resumeBackgroundAudio"),window.resumeBackgroundAudio?window.resumeBackgroundAudio():t.error("[video.js] resumeBackgroundAudio not found on window"))}function X(a,s,m=1e3){if(!a)return;const e=a.volume,f=performance.now(),p=O=>{const r=O-f,L=Math.min(r/m,1),d=L*L;a.volume=e+(s-e)*d,L<1&&requestAnimationFrame(p)};requestAnimationFrame(p)}function be(){const a=document.querySelector("#video"),s=document.querySelector(".video-wrapper");if(!a||!s)return;if(s.querySelector("iframe#youtube-video-iframe")){t.log("YouTube iframe detected, setting up lazy loading");const o=document.querySelector(".video-start-overlay");o&&o.addEventListener("click",function l(n){n.preventDefault(),n.stopPropagation();try{if(!window.audioMuted&&window.playUIClickSound)try{window.playUIClickSound()}catch(c){t.warn("Could not play UI click sound:",c)}t.log("[video.js] Overlay clicked, fading out audio immediately");try{window.cancelActiveFade&&window.cancelActiveFade(),window.fadeBackgroundAudio?window.fadeBackgroundAudio(.001,1e3,()=>{t.log("[video.js] Background audio ducked (vol 0.001) via overlay click")}):window.backgroundAudio&&(window.backgroundAudio.volume=.001)}catch(c){t.warn("Audio fade error (non-critical):",c)}o.classList.add("hidden"),fe();const u=document.getElementById("youtube-video-iframe");if(u){const c=()=>{try{me(()=>{t.log("[video.js] YouTube player initialized after lazy load"),I()})}catch(de){t.error("YouTube player init error:",de)}};u.src&&u.contentWindow?setTimeout(c,200):(u.addEventListener("load",c,{once:!0}),setTimeout(c,1e3))}setTimeout(()=>{try{o.remove(),I()}catch(c){t.warn("Overlay remove error:",c)}},400),setTimeout(()=>{try{window.lenis&&typeof window.lenis.start=="function"&&(window.lenis.start(),t.log("[video.js] Ensured Lenis is running after video click")),window.ScrollTrigger&&typeof window.ScrollTrigger.refresh=="function"&&(window.ScrollTrigger.refresh(),t.log("[video.js] Refreshed ScrollTrigger after video click"))}catch(c){t.warn("Scroll safeguard error:",c)}},500)}catch(u){t.error("Video overlay click error (caught to prevent page break):",u),setTimeout(()=>{try{window.lenis&&typeof window.lenis.start=="function"&&window.lenis.start(),window.ScrollTrigger&&typeof window.ScrollTrigger.refresh=="function"&&window.ScrollTrigger.refresh()}catch{}},100)}o.removeEventListener("click",l)});const i=document.querySelector("#video");i&&new IntersectionObserver(n=>{n.forEach(u=>{if(!u.isIntersecting&&E){t.log("[video.js] Main video scrolled out of view, pausing");try{E.getPlayerState()===1&&E.pauseVideo()}catch(c){t.warn("[video.js] Could not pause video:",c)}setTimeout(()=>{!(window.isMainVideoPlaying?window.isMainVideoPlaying():!1)&&window.resumeBackgroundAudio&&!window.audioMuted&&window.resumeBackgroundAudio()},300)}})},{threshold:.25}).observe(i);return}const e=s.querySelector("video");if(!e){t.log("No <video> element found in .video-wrapper, skipping custom video controls");return}t.log("Custom .mp4 video player detected, initializing controls"),window.isMainVideoPlaying=()=>{try{return e&&!e.paused}catch{return!1}};let f=!1;const p=(o=!1)=>{f||(f=!0,t.log("[video.js] Loading video source..."+(o?" (skip load, caller will trigger)":"")+(v?" [Safari/iOS mode]":"")),v&&(e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline","")),e.src=le,e.preload="metadata",o||e.load(),setTimeout(()=>{e&&!e.paused||(e.preload="auto",t.log("[video.js] Upgraded preload to auto for buffering"))},2e3))};e.poster=ue,v&&(e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline",""),e.setAttribute("x-webkit-airplay","allow"),t.log("[video.js] Safari/iOS: Set required video attributes"));const O=()=>{const o=v?1500:4e3;typeof requestIdleCallback<"u"&&!v?(requestIdleCallback(()=>{p()},{timeout:o}),t.log("[video.js] Scheduled video load via requestIdleCallback")):(setTimeout(()=>{p()},v?1500:2e3),t.log("[video.js] Scheduled video load via setTimeout"+(v?" (Safari/iOS)":" (fallback)")))};if(a){const o=new IntersectionObserver(i=>{i.forEach(l=>{l.isIntersecting&&!f&&(t.log("[video.js] Video section approaching viewport, loading immediately"),p(),o.disconnect())})},{rootMargin:"50% 0px",threshold:0});o.observe(a)}O(),e.addEventListener("error",o=>{f&&(t.error("Video loading error:",o),t.error("Video src:",e.src),t.error("Video error code:",e.error?.code),t.error("Video error message:",e.error?.message))}),e.addEventListener("loadeddata",()=>{t.log("[video.js] Video data loaded successfully"),e.style.opacity="1",e.pause()}),e.addEventListener("loadedmetadata",()=>{t.log("[video.js] Video metadata loaded"),e.style.display="none",e.offsetHeight,e.style.display=""});const r=document.createElement("div");r.className="video-overlay";const L=document.createElement("div");L.className="play-button",r.appendChild(L),e.parentNode.insertBefore(r,e.nextSibling);const d=document.createElement("div");d.className="video-audio-slider",d.innerHTML=`
    <div class="audio-slider-track">
      <div class="audio-slider-fill"></div>
      <div class="audio-slider-thumb"></div>
    </div>
    <div class="audio-icon">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" fill="currentColor"/>
      </svg>
    </div>
  `,d.style.cssText=`
    position: absolute;
    bottom: 20px;
    left: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    padding: 8px 12px;
    border-radius: 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 10;
    color: white;
    font-size: 14px;
  `;const q=d.querySelector(".audio-slider-track");q.style.cssText=`
    width: 80px;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    position: relative;
    cursor: pointer;
  `;const _=d.querySelector(".audio-slider-fill");_.style.cssText=`
    height: 100%;
    background: white;
    border-radius: 2px;
    width: 50%;
    transition: width 0.1s ease;
  `;const H=d.querySelector(".audio-slider-thumb");H.style.cssText=`
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 12px;
    height: 12px;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    transition: left 0.1s ease;
  `;const te=d.querySelector(".audio-icon");te.style.cssText=`
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
  `,e.parentNode.appendChild(d);const g=document.createElement("div");g.className="video-progress-bar",g.innerHTML=`
    <div class="progress-bar-track">
      <div class="progress-bar-fill"></div>
      <div class="progress-bar-thumb"></div>
    </div>
  `,g.style.cssText=`
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: rgba(0, 0, 0, 0);
    cursor: pointer;
    z-index: 10;
    transition: height 0.2s ease, background 0.2s ease;
  `;const x=g.querySelector(".progress-bar-track");x.style.cssText=`
    width: 100%;
    height: 100%;
    position: relative;
    cursor: pointer;
  `;const P=g.querySelector(".progress-bar-fill");P.style.cssText=`
    height: 100%;
    background:rgba(111, 237, 238, 0.88);
    width: 0%;
    transition: width 0.1s linear;
    pointer-events: none;
  `;const h=g.querySelector(".progress-bar-thumb");h.style.cssText=`
    position: absolute;
    top: 50%;
    left: 0%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: rgba(111, 237, 238, 1);
    border-radius: 50%;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.2s ease;
    pointer-events: none;
  `,e.parentNode.appendChild(g);let C=!1;const W=.3,$=.18,y=()=>{const i=e.volume/W*100;_.style.width=i+"%",H.style.left=i+"%"},K=o=>{const i=q.getBoundingClientRect(),n=Math.max(0,Math.min(100,(o-i.left)/i.width*100))/100*W;if(window.audioMuted&&n>0){const u=document.querySelector(".sound-toggle");u&&u.classList.contains("muted")&&(N=!0,u.click(),setTimeout(()=>{N=!1},100))}n>0?e.muted=!1:e.muted=!0,e.volume=n,n>0&&(k=n),y()};q.addEventListener("mousedown",o=>{C=!0,K(o.clientX),o.preventDefault()}),document.addEventListener("mousemove",o=>{C&&K(o.clientX)}),document.addEventListener("mouseup",()=>{C=!1}),s.addEventListener("mouseenter",()=>{e.paused||(d.style.opacity="1",d.style.pointerEvents="auto")}),s.addEventListener("mouseleave",()=>{d.style.opacity="0",d.style.pointerEvents="none"}),e.addEventListener("volumechange",y),e.volume=$,window.audioMuted?(e.muted=!0,e.volume=0):e.muted=!1,y();let T=!1;const z=()=>{if(e.duration&&!T){const o=e.currentTime/e.duration*100;P.style.transition="none",P.style.width=o+"%",h.style.left=o+"%"}},D=o=>{const i=x.getBoundingClientRect(),n=Math.max(0,Math.min(100,(o-i.left)/i.width*100))/100*e.duration;e.currentTime=n,z(),e.paused||A()},G=()=>{P.style.transition="none",h.style.transition="opacity 0.2s"},J=()=>{P.style.transition="width 0.1s linear",h.style.transition="opacity 0.2s"};x.addEventListener("mousedown",o=>{T=!0,G(),D(o.clientX),o.preventDefault()}),x.addEventListener("click",o=>{T||(G(),D(o.clientX),setTimeout(()=>{J()},50))}),document.addEventListener("mousemove",o=>{T&&D(o.clientX)}),document.addEventListener("mouseup",()=>{T=!1,J()}),g.addEventListener("mouseenter",()=>{h.style.opacity="1",g.style.height="8px",g.style.background="rgba(0, 0, 0, 0.3)"}),g.addEventListener("mouseleave",()=>{T||(h.style.opacity="0"),g.style.height="4px",g.style.background="rgba(0, 0, 0, 0)"});let S=null,U=0;const Q=()=>{if(e.duration&&!T&&!e.paused){const o=performance.now();if(o-U>=16.67){const i=e.currentTime/e.duration*100;P.style.width=i+"%",h.style.left=i+"%",U=o}S=requestAnimationFrame(Q)}},A=()=>{S&&cancelAnimationFrame(S),U=performance.now(),S=requestAnimationFrame(Q)},oe=()=>{S&&(cancelAnimationFrame(S),S=null)};e.addEventListener("play",A),e.addEventListener("pause",oe),e.addEventListener("timeupdate",z),z();let k=$,w=null;const ie=()=>{e.paused||(k=e.volume,X(e,0,600),w=setTimeout(()=>{e.pause(),w=null},600))},ae=()=>{e.paused||(w&&(clearTimeout(w),w=null),e.pause())},re=()=>{if(!r.classList.contains("loading"))if(e.paused){if(w&&(clearTimeout(w),w=null),v){t.log("[video.js] Safari/iOS: User clicked play"),r.classList.add("loading"),f||(t.log("[video.js] Safari/iOS: Loading video source..."),p(!0)),e.load(),setTimeout(()=>{t.log("[video.js] Safari/iOS: Proceeding to playVideo after load delay, readyState: "+e.readyState),b()},500);return}if(!f){t.log("[video.js] User clicked play before lazy load, loading immediately"),r.classList.add("loading");const o=()=>{t.log("[video.js] canplaythrough event fired"),e.removeEventListener("canplaythrough",o),e.removeEventListener("canplay",i),e.removeEventListener("loadeddata",l),clearTimeout(n),b()},i=()=>{t.log("[video.js] canplay event fired"),e.removeEventListener("canplaythrough",o),e.removeEventListener("canplay",i),e.removeEventListener("loadeddata",l),clearTimeout(n),b()},l=()=>{t.log("[video.js] loadeddata event fired"),e.removeEventListener("canplaythrough",o),e.removeEventListener("canplay",i),e.removeEventListener("loadeddata",l),clearTimeout(n),b()};e.addEventListener("canplaythrough",o),e.addEventListener("canplay",i),e.addEventListener("loadeddata",l);const n=setTimeout(()=>{e.removeEventListener("canplaythrough",o),e.removeEventListener("canplay",i),e.removeEventListener("loadeddata",l),t.log("[video.js] Timeout reached, attempting to play anyway (readyState: "+e.readyState+")"),b()},3e3);p(!0),e.load(),t.log("[video.js] Video load triggered, waiting for events...");return}if(e.readyState<2){t.log("[video.js] Video not ready (readyState: "+e.readyState+"), waiting for data..."),r.classList.add("loading");const o=()=>{t.log("[video.js] Data ready event fired"),e.removeEventListener("canplay",o),e.removeEventListener("loadeddata",o),clearTimeout(i),b()};e.addEventListener("canplay",o),e.addEventListener("loadeddata",o);const i=setTimeout(()=>{e.removeEventListener("canplay",o),e.removeEventListener("loadeddata",o),t.log("[video.js] Data timeout reached, attempting to play anyway (readyState: "+e.readyState+")"),b()},3e3);e.load();return}b()}else ae()},b=async()=>{if(t.log("[video.js] playVideo called - readyState: "+e.readyState+", paused: "+e.paused+", networkState: "+e.networkState),r.classList.remove("loading"),window.backgroundAudio&&X(window.backgroundAudio,0),v){t.log("[video.js] Safari/iOS detected - using Safari-specific playback sequence");try{e.readyState<1&&(t.log("[video.js] Safari: Video not ready, triggering load..."),e.load(),await new Promise((i,l)=>{const n=setTimeout(()=>{t.log("[video.js] Safari: loadedmetadata timeout, proceeding anyway"),i()},5e3),u=()=>{clearTimeout(n),e.removeEventListener("loadedmetadata",u),e.removeEventListener("loadeddata",u),t.log("[video.js] Safari: Video metadata loaded"),i()};e.addEventListener("loadedmetadata",u),e.addEventListener("loadeddata",u)})),t.log("[video.js] Safari: Starting video muted first..."),e.muted=!0,e.volume=0;const o=e.play();o!==void 0&&await o,t.log("[video.js] Safari: Muted playback started successfully"),r.classList.add("hidden"),A(),window.audioMuted?y():setTimeout(()=>{e&&!e.paused&&(t.log("[video.js] Safari: Unmuting video..."),e.muted=!1,e.volume=k,y(),t.log("[video.js] Safari: Video unmuted successfully, volume: "+k))},100);return}catch(o){t.error("[video.js] Safari playback failed:",o.name,o.message);try{t.log("[video.js] Safari: Trying fallback with controls attribute..."),e.setAttribute("controls",""),e.muted=!0;const i=e.play();i!==void 0&&await i,setTimeout(()=>{e.removeAttribute("controls")},500),r.classList.add("hidden"),A(),window.audioMuted||setTimeout(()=>{e.muted=!1,e.volume=k,y()},100);return}catch(i){t.error("[video.js] Safari fallback also failed:",i),r.classList.remove("hidden"),r.classList.remove("loading");return}}}window.audioMuted?(e.volume=0,e.muted=!0):(e.muted=!1,e.volume=k);try{t.log("[video.js] Attempting to play video...");const o=e.play();o!==void 0&&await o,r.classList.add("hidden"),y(),A(),t.log("[video.js] Video playback started successfully")}catch(o){t.warn("[video.js] Play failed:",o.name,o.message);try{t.log("[video.js] Retrying with muted video..."),e.muted=!0;const i=e.play();i!==void 0&&await i,r.classList.add("hidden"),t.log("[video.js] Playing muted due to autoplay policy"),y(),A()}catch(i){t.error("[video.js] Play failed even when muted:",i.name,i.message),r.classList.remove("hidden"),r.classList.remove("loading")}}};let Z=0;const ne=300,V=o=>{const i=Date.now();if(i-Z<ne){t.log("[video.js] Debounced duplicate play/pause trigger");return}Z=i,re()};r.addEventListener("click",V),e.addEventListener("click",V),r.addEventListener("touchend",o=>{o.preventDefault(),V()},{passive:!1}),e.addEventListener("touchend",o=>{o.preventDefault(),V()},{passive:!1}),e.addEventListener("ended",()=>{r.classList.remove("hidden"),d.style.opacity="0",d.style.pointerEvents="none",!window.audioMuted&&window.resumeBackgroundAudio&&(t.log("[video.js] Video ended, resuming background audio"),window.resumeBackgroundAudio())}),e.addEventListener("pause",()=>{r.classList.remove("hidden"),d.style.opacity="0",d.style.pointerEvents="none",!window.audioMuted&&window.resumeBackgroundAudio&&(t.log("[video.js] Video paused, resuming background audio"),window.resumeBackgroundAudio())}),new IntersectionObserver(o=>{o.forEach(i=>{if(!i.isIntersecting){const l=!e.paused;ie(),l&&(t.log("[video.js] Custom video left viewport after playing, ensuring background audio resumes"),setTimeout(()=>{!(window.isMainVideoPlaying?window.isMainVideoPlaying():!1)&&window.resumeBackgroundAudio&&!window.audioMuted&&window.resumeBackgroundAudio()},800))}})},{threshold:.5}).observe(a);const B=()=>{!e.paused&&!e.ended&&(window.audioMuted?(e.volume=0,e.muted=!0):(e.muted=!1,N||(e.volume=k),window.backgroundAudio&&!window.backgroundAudio.paused&&X(window.backgroundAudio,0)),y())},F=document.querySelector(".sound-toggle");if(F){F.addEventListener("click",()=>{setTimeout(()=>{B()},50)}),new MutationObserver(l=>{l.forEach(n=>{n.type==="attributes"&&n.attributeName==="class"&&setTimeout(()=>{B()},50)})}).observe(F,{attributes:!0,attributeFilter:["class"]});let i=window.audioMuted;setInterval(()=>{window.audioMuted!==i&&(i=window.audioMuted,B())},500),setTimeout(()=>{B()},1e3)}}export{be as initVideo};
